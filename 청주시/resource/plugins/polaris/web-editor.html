<!DOCTYPE html>
<html>
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <script type="text/javascript" src="polaris.js"></script>
        <script type="text/javascript" src="api/apis.js"></script>
    </head>

    <body>
        <table style="width:100%;">
            <tr>
                <td style="width:23cm; padding-right:10px;">
                    <!-- Polaris Editor 영역 -->
                    <textarea id="Document_HwpCtrl">
                    </textarea>
                </td>
                <td  valign=top>
                     <div id="polaris_api" style="">
                        <b>새 문서</b>
                        <input onclick="Clear(PolarisEditor.Opt.Discard);" type="button" value="Clear(PolarisEditor.Opt.Discard)">
                        <br><br><b>HTML 받아오기</b>
                        <input onclick="GetTextFile('HTML');" type="button" value="GetTextFile('HTML')">
                        <br><br><b>HTML 설정하기</b>
                        <input onclick="SetTextFile('HTML');" type="button" value="SetTextFile(HTML')">
                        <br><br><b>HTML 삽입하기</b>
                        <input onclick="SetTextFile('HTML', 'insertfile');" type="button" value="SetTextFile(HTML', 'insertfile')">
                        <br><br><b>텍스트 받아오기</b>
                        <input onclick="GetTextFile('TEXT');" type="button" value="GetTextFile('TEXT')">
                        <br><br><b>텍스트 설정하기</b>
                        <input onclick="SetTextFile('TEXT');" type="button" value="SetTextFile(TEXT')">
                        <br><br><b>텍스트 삽입하기</b>
                        <input onclick="SetTextFile('TEXT', 'insertfile');" type="button" value="SetTextFile('TEXT', 'insertfile')">

                        <br><br><b>문서 편집 관련</b><br>
                        <input onclick="TestSelectionMode();" type="button" value="SelectionMode">
                        <input onclick="SelectText();" type="button" value="SelectText()">
                        <input onclick="GetTableCellAddr();" type="button" value="GetTableCellAddr()">
                        <br><br><b>표 편집 관련 Action</b><br>
                        <input onclick="TestTableBorderAction(1, 1);" type="button" value="CellBorder: Solid">
                        <input onclick="TestTableBorderAction(0, 1);" type="button" value="CellBorder: None">

                        <br><br><b>에디터 높이 변경</b><br>
                        height: <input type="number" value=100 id="editorHeight" style="width: 50px;">px <input type="button" value="변경" onclick="resizeEditor()">

                        <br><br><b>이미지 삽입 Dialog</b><br>
						<input onclick="ShowImageDlg();" type="button" value="이미지삽입">

						<br><br><b>툴바</b><br>
						<input onclick="ToolbarOn();" type="button" value="툴바On">
						<input onclick="ToolbarOff();" type="button" value="툴바Off">


						<br><br><b>컨텐츠 다운로드</b><br>
						<input onclick="bodyDownload();" type="button" value="다운로드">

						<br><br><b>SetEditMode</b><br>
						<input onclick="SetEditMode(1);" type="button" value="SetEditMode(1)">
						<input onclick="SetEditMode(0);" type="button" value="SetEditMode(0)">

                    </div>
                </td>
            </tr>
        </table>

        <script>
            var POEditor = new PolarisEditor();

        	// Polaris Editor 로딩
            var loadCompleteCallback = function() {
                // disable action & menu function
                POEditor.LockCommand("Print");
                POEditor.LockCommand("CopyFormat");
                POEditor.LockCommand("fontShape");
                POEditor.LockCommand("PasteText");
                POEditor.LockCommand("PasteFromWord");
            }

            var NotifyMessage = function(msg, wparam, lparam) {
                if (msg == "OnBeforeUpload") {
                    var args = wparam;
                    var returnValue = lparam;

                    var type = args.type;
                    var file = args.file;

                    if (type == 'image') {
                        var req = {
                            url : '',
                            formData : {
                                name : file.name,
                                file : file
                            }
                        };
                        returnValue.request = req;
                    }
                    return;
                }
                else if (msg == "OnAfterUpload") {
                    var args = wparam;
                    var returnValue = lparam;

                    var type = args.type;
                    var result = args.result;

                    if (type == 'image') {
                        /*
                        // json으로 결과가 왔을 경우 예제
                        //var o = JSON.parse(result);
                        //returnValue.returnValue = o.url;
                        */

                        //result로 넘어온 서버 응답에서 URL을 추출 및 가공하여 IMG 태그로 삽입할 수 있는 URL을 리턴 합니다.
                        var parts = result.match(/\((?:"|')?\d|null+(?:"|')?,\s*("|')(.*?[^\\]?)\1(?:,\s*(.*?))?\s*\)\s*;?/);
                        var fileUrl = parts && parts[2];
                        var resultVal = (parts && parts[3]).split(",");

                        if(resultVal.length > 1)
                        {
                            deleteFileUrl = resultVal[1].replace(/'/g,"");
                            fileSize = resultVal[2].replace(/'/g,"");
                            fileId = resultVal[3].replace(/'/g,"");
                        }

                        msg = resultVal[0].replace(/'/g,"");

                        // The server response usually is automatically parsed by the js engine, but in this case we get the "raw content"
                        // and must take care of un-escaping it.
                        // So far I haven't been able to find a single function that does it correctly in all the cases
                        if (fileUrl)
                        {
                            fileUrl = fileUrl.replace(/\\'/g, "'");

                            // Try to handle URLs with escaped chars like 51-Body/\u00E6\u00F8\u00E5.jpg
                            try
                            {
                                var o = JSON.parse('{"url":"' + fileUrl + '"}');
                                if (o && o.url)
                                    fileUrl = o.url;
                            }
                            catch (ex) { }
                        }
                        returnValue.returnValue = fileUrl;
                    }
                    return;
                }
            }
            // 각종 콜백 메시지 수신
            POEditor.NotifyMessage = NotifyMessage;

            var config = {
                wordprocessor: false,
                showTitlebar: true,
                showMenubar: true,  // 리본 메뉴를 사용할 경우 true 필요
                width: "23cm",
                height: "14cm",
				useImageBase64Encoding: true,
                documentFontSize: 12,   //pt기준
                documentFontFamily: '돋움',
                toolbarMode: 2,     // 리본 메뉴부터 사용(1 : menubar + toolbar, 2: ribbon + qat)
                externalVideoLinkUrl: "plugins/externalmedia/sample_videolist.html",
                externalDocumentLinkUrl: "plugins/externalmedia/sample_documentlist.html",
				defaultAdjustImageSize: 600
            };

            // 리본 메뉴 모드에서 하단 툴바 버튼의 정의
            config.quickaccesstoolbar = [ { name: 'row1',   items: [ 'Undo', 'Redo', '-',
                 'Font', 'FontSize', 'Bold', 'Italic', 'Underline', 'Strike', 'TextColor', 'BGColor',
                 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock', '-',
                 'lineheight', 'letter-spacing', '-', 'Outdent', 'Indent', '-', 'InsertExternalVideoUrl', 'InsertExternalDocumentUrl' ] }, '/' ];

            // 툴바 메뉴 모드에서 툴바 버튼의 정의
            config.toolbar = [
                {
                    name : 'TOOLBAR_STANDARD',
                    show : true,
                    items : [ 'Print', '-', 'Undo', 'Redo', '-', 'Cut', 'Copy', 'Paste', '-', 'FontShape', 'ParagraphForm', '-', 'PageOutline', 'HeaderFooter', '-', 'SpecialChar', '-', 'Outdent', 'Indent', '-', 'InsertExternalVideoUrl', 'InsertExternalDocumentUrl' ]
                },
                '/',
                {
                    name : 'TOOLBAR_FORMAT',
                    show : true,
                    items : [ 'Font', 'FontSize', 'Bold', 'Italic', 'Underline', 'Strike', 'TextColor', 'BGColor', 'JustifyLeft', 'JustifyCenter','JustifyRight', 'JustifyBlock', 'lineheight', 'letter-spacing', 'ZoomCombo', 'Image', 'Table' ]
                },
                '/'
            ];

            var result = POEditor.CreateEditor("Document_HwpCtrl", config, loadCompleteCallback);


            var TEXTDATA = "";

            function Clear(option) {
                POEditor.Clear(option);
            }

            function GetTextFile(format) {
                TEXTDATA = POEditor.GetTextFile(format);
                alert(TEXTDATA);
            }

            function SetTextFile(format, option) {
                if (TEXTDATA.length == 0)
                    TEXTDATA = "SetTextFile Test";
                var result = POEditor.SetTextFile(TEXTDATA, format, option);
            }

            function ShowImageDlg() {
            	POEditor.ShowImagePopup();
            }

            function resizeEditor() {
                var editorHeight = document.getElementById("editorHeight").value;

                var editor1 = document.getElementById("Document_HwpCtrl");
                editor1.ResizeEditor("100%", editorHeight, true);
            }

            function ToolbarOn() {
            	POEditor.ShowToolBar(true);
            }

            function ToolbarOff() {
            	POEditor.ShowToolBar(false);
            }

            function click(element) {
                try {
                    var event = new MouseEvent("click");
                    element.dispatchEvent(event);
                }
                catch( e ) {
                    element.click();
                }
            }

            function bodyDownload() {
                var body = POEditor.GetTextFile("HTML");
                body = new Blob([body], {type:'text/html'});
                var downloadLink = document.createElement("a");
                downloadLink.download = "bodyfile.html";
                downloadLink.innerHTML = "Download File";

                if (window.webkitURL != null) {
                    downloadLink.href = window.webkitURL.createObjectURL(body);
                    click(downloadLink);
                }
                else if (window.navigator.msSaveOrOpenBlob) {
                    window.navigator.msSaveOrOpenBlob(body, downloadLink.download);
                }
                else {
                    downloadLink.href = window.URL.createObjectURL(body);
                    downloadLink.style.display = "none";
                    document.body.appendChild(downloadLink);
                    click(downloadLink);
                }
            }

            function SetEditMode(value) {
                POEditor.SetEditMode(value);
            }
        </script>
    </body>
</html>
