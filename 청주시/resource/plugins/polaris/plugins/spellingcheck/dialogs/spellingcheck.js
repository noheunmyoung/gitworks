(function(){function z(e){return e.type==POLARIS.NODE_TEXT&&0<e.getLength()&&!e.isReadOnly()}function A(e){return!(e.type==POLARIS.NODE_ELEMENT&&e.isBlockBoundary(POLARIS.tools.extend({},POLARIS.dtd.$empty,POLARIS.dtd.$nonEditable)))}function u(e){function p(a,b){var c=this,d=new POLARIS.dom.walker(a);d.guard=b?A:function(a){!A(a)&&(c._.matchBoundary=!0)};d.evaluator=z;d.breakOnFalse=1;a.startContainer.type==POLARIS.NODE_TEXT&&(this.textNode=a.startContainer,this.offset=a.startOffset-1);this._={matchWord:b,
walker:d,matchBoundary:!1}}function v(a,b){var c=e.createRange(),d=a.textNode,n=e.editable();c.setStart(d,b?a.offset:a.offset+1);if(e.config.wordprocessor&&m){var g=m.length,h,l;for(h=0;h<g;h++)if(l=m[h],l.contains(d)){c.setEndAt(l,POLARIS.POSITION_BEFORE_END);break}c.endContainer||c.setEndAt(n,POLARIS.POSITION_BEFORE_END)}else c.setEndAt(n,POLARIS.POSITION_BEFORE_END);return c}function u(a){var b=[],c=0;if(a)for(var d=0;d<a.length;d++){var e=b,g='\x3cdiv style\x3d"text-align:left;font-size: 12px;line-height: 32px;"\x3e'+
a[d]+"\x3c/div\x3e",h=POLARIS.tools.getNextNumber();e.push('\x3ctr role\x3d"presentation"\x3e\x3ctd class\x3d"polaris_time_format_list_td" style\x3d"vertical-align: center;" role\x3d"presentation"\x3e\x3ca href\x3d"javascript:void(0)" role\x3d"option" style\x3d"height: auto; overflow: hidden;" aria-labelledby\x3d"'+h+'"',' class\x3d"polaris_list_item polaris_hand" tabindex\x3d"-1" header-footer-index\x3d"'+c+'"\x3e','\x3cspan id\x3d"'+h+'"\x3e'+g+"\x3c/span\x3e\x3c/a\x3e","\x3c/td\x3e\x3c/tr\x3e");
c++}return b.join("")}function w(a){var b=[],c=[],d;if(e.config.wordprocessor)for(var n=e.plugins.spellingcheck.getSearchContentOnly(),g=e.plugins.pagination.getPageList(),h=0;h<g.count();h++){d=g.getItem(h);var l=n?d.body:d.owner;l.mergeTextNodes();d=e.createRange();d.setStartAt(l,POLARIS.POSITION_AFTER_START);d.setEndAt(l,POLARIS.POSITION_BEFORE_END);c.push(l);b.push(d)}else n=e.editable(),n.mergeTextNodes(),d=e.createRange(),d.setStartAt(n,POLARIS.POSITION_AFTER_START),d.setEndAt(n,POLARIS.POSITION_BEFORE_END),
c.push(n),b.push(d);m=c;k.initSpellchecker(b,POLARIS.filterDictionary)==k.FIND_MATCHED?q(a):(B(e),x(a),r=!1,a.hide())}function q(a){for(var b=k.searchRanges.length,c=k.currentSearchIndex;c<b;c++)if(k.find(c)==k.FIND_MATCHED){var c=k.getMatchWord(),b=a,d=k.filterDictionary[c];d&&(d=d.split(","),b.getContentElement("spellingcheck","txtFindSpelling").setValue(c),b.getContentElement("spellingcheck","txtChangeWord").setValue(d[0]),b.getContentElement("spellingcheck","txtSuggestWordContainer").getElement().setHtml(u(d)));
y(a,!0);return}B(e);x(a);r=!1;a.hide()}function B(a){(new POLARIS.plugins.notification(a,{message:f.checkComplete,type:"info",duration:1500,width:240,valign:"top",align:"center"})).show()}function x(a){k.clear();y(a,!1);a.getContentElement("spellingcheck","txtSuggestWordContainer").getElement().setHtml("")}function y(a,b){var c=a.getContentElement("spellingcheck","btnFindStartSkip"),d=a.getContentElement("spellingcheck","btnFindSkipContinue"),e=a.getContentElement("spellingcheck","btnReplace"),g=
a.getContentElement("spellingcheck","btnReplaceAll");b?(c.getInputElement().getFirst().setHtml(f.findSkip),d.enable(),e.enable(),g.enable()):(c.getInputElement().getFirst().setHtml(f.findStart),d.disable(),e.disable(),g.disable())}var C=new POLARIS.style(POLARIS.tools.extend({attributes:{"data-polaris-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},e.config.spellingcheck_highlight,!0));p.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},
move:function(a){var b=this.textNode;if(null===b)return D.call(this);this._.matchBoundary=!1;if(b&&a&&0<this.offset)this.offset--;else if(b&&!a&&this.offset<b.getLength()-1)this.offset++;else{for(b=null;!b&&!(b=this._.walker[a?"previous":"next"].call(this._.walker),this._.matchWord&&!b||this._.walker._.end););this.offset=(this.textNode=b)?a?b.getLength()-1:0:0}return D.call(this)}};var t=function(a,b,c){this._={walker:a,cursors:[],rangeLength:b,highlightRange:null,isComplete:!1,matcher:c}};t.prototype=
{toDomRange:function(){var a=e.createRange(),b=this._.cursors;if(1>b.length){var c=this._.walker.textNode;if(c)a.setStartAfter(c);else return null}else c=b[0],b=b[b.length-1],a.setStart(c.textNode,c.offset),a.setEnd(b.textNode,b.offset+1);return a},updateFromDomRange:function(a){var b=new p(a);this._.cursors=[];do a=b.next(),a.character&&this._.cursors.push(a);while(a.character);this._.rangeLength=this._.cursors.length},setComplete:function(a){this._.isComplete=a},isComplete:function(){return this._.isComplete},
getMatcher:function(){return this._.matcher},highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var a=this.toDomRange();C.applyToRange(a,e);this._.highlightRange=a;var b=a.startContainer;b.type!=POLARIS.NODE_ELEMENT&&(b=b.getParent());b.scrollIntoView();this.updateFromDomRange(a)}},removeHighlight:function(){this._.highlightRange&&(C.removeFromRange(this._.highlightRange,e),this.updateFromDomRange(this._.highlightRange),this._.highlightRange=null)},isReadOnly:function(){return this._.highlightRange?
this._.highlightRange.startContainer.isReadOnly():0},moveBack:function(){var a=this._.walker.back(),b=this._.cursors;a.hitMatchBoundary&&(this._.cursors=b=[]);b.unshift(a);b.length>this._.rangeLength&&b.pop();return a},moveNext:function(){var a=this._.walker.next(),b=this._.cursors;a.hitMatchBoundary&&(this._.cursors=b=[]);b.push(a);b.length>this._.rangeLength&&b.shift();return a},getEndCharacter:function(){var a=this._.cursors;return 1>a.length?null:a[a.length-1].character},getStartCharacter:function(){var a=
this._.cursors;return 1>a.length?null:a[0].character},getNextCharacterRange:function(a){var b,c;c=this._.cursors;c=(b=c[c.length-1])&&b.textNode?new p(v(b)):this._.walker;return new t(c,a,this._.matcher)},getBeforeCharacterRange:function(a){var b;if((b=this._.cursors[0])&&b.textNode){var c=e.createRange(),d=b.textNode,n=e.editable();if(e.config.wordprocessor&&m){var g=m.length,h,l;for(h=0;h<g;h++)if(l=m[h],l.contains(d)){c.setStartAt(l,POLARIS.POSITION_AFTER_START);break}c.startContainer||c.setStartAt(n,
POLARIS.POSITION_AFTER_START)}else c.setStartAt(n,POLARIS.POSITION_AFTER_START);c.setEnd(d,b.offset);b=new p(c)}else b=this._.walker;return new t(b,a,this._.matcher)},getCursors:function(){return this._.cursors}};var m,E=function(a,b){var c=[-1];b&&(a=a.toLowerCase());for(var d=0;d<a.length;d++)for(c.push(c[d]+1);0<c[d+1]&&a.charAt(d)!=a.charAt(c[d+1]-1);)c[d+1]=c[c[d+1]-1]+1;this._={overlap:c,state:0,ignoreCase:!!b,pattern:a}};E.prototype={feedCharacter:function(a){for(this._.ignoreCase&&(a=a.toLowerCase());;)return a==
this._.pattern.charAt(this._.state)?(this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1):0},reset:function(){this._.state=0}};var k={FIND_NOMATCH:0,FIND_MATCHED:1,filterDictionary:null,searchRanges:[],searchFilters:[],currentSearchIndex:0,ignoreWords:[],matchRange:null,clear:function(){var a=this.matchRange;a&&a.removeHighlight();this.searchRanges=[];this.searchFilters=[];this.currentSearchIndex=0;this.ignoreWords=[];this.matchRange=null},initSpellchecker:function(a,b){function c(a){a=
new POLARIS.dom.walker(a);a.breakOnFalse=1;a.evaluator=z;for(var b=[],c;c=a.next();)b.push(c.getText());return b.join("")}var d=k.FIND_NOMATCH,e=new RegExp(Object.keys(b).join("|"),"gi"),g=[],h=a.length,l,f,m;for(l=0;l<h;l++)f=a[l],f=c(f),m=[],f.replace(e,function(a){-1==m.indexOf(a)&&m.push(a);d=k.FIND_MATCHED;return a}),g.push(m.sort().reverse());this.filterDictionary=b;this.searchRanges=a;this.searchFilters=g;this.currentSearchIndex=0;return d},createCharacterRanges:function(a,b){var c=[],d=k.ignoreWords,
e=b.length,g,h,l,f;for(g=0;g<e;g++)h=b[g],-1<d.indexOf(h)||(f=new E(h,!0),l=new p(a),h=new t(l,h.length,f),c[c.length]=h);return c},find:function(a){this.currentSearchIndex=a;var b=this.matchRange;b?(b.removeHighlight(),b=b.getCursors(),b=v(b[b.length-1]),this.matchRange=null,a=this.createCharacterRanges(b,this.searchFilters[a])):a=this.createCharacterRanges(this.searchRanges[a],this.searchFilters[a]);for(var b=a.length,c,d,e,g,h,f,m;;){c=0;d=!0;for(e=0;e<b;e++)if(g=a[e],h=g.getMatcher(),m=!1,!g.isComplete()){for(g.moveNext();f=
g.getEndCharacter();){c=h.feedCharacter(f);if(2==c)break;else if(0==c){h.reset();m=!0;break}g.moveNext().hitMatchBoundary&&h.reset()}if(2==c)return this.matchRange=g,g.highlight(),k.FIND_MATCHED;1==m?d=!1:g.setComplete(!0)}if(d)return k.FIND_NOMATCH}},replace:function(a,b,c){var d=k.FIND_NOMATCH,f=this.matchRange,g=this.getMatchWord();f&&!f.isReadOnly()&&g==b&&(f.removeHighlight(),b=f.getCursors(),b=v(b[b.length-1]),b.trim(),b=(new p(b,!0)).next(),/ /.test(b.character)&&(d=b.textNode.getText().replace(/^ /g,
" "),b.textNode.setText(d)),b=f.toDomRange(),c=e.document.createText(c),b.deleteContents(),b.insertNode(c),f.updateFromDomRange(b),f.highlight(),d=k.FIND_MATCHED,q(a));return d},getMatchWord:function(){for(var a="",b=this.matchRange,c=b?b.getCursors():null,b=c?b.getCursors().length:0,d=0;d<b;d++)a+=c[d].character;return a}},f=e.lang.spellingcheck,r=!0;return{title:f.title,resizable:POLARIS.DIALOG_RESIZE_NONE,minWidth:290,minHeight:100,buttons:[POLARIS.dialog.cancelButton(e,{label:e.lang.common.close})],
contents:[{id:"spellingcheck",label:f.spellingcheck,elements:[{type:"hbox",widths:["auto",68],children:[{type:"text",id:"txtFindSpelling",label:"",widths:[0,"auto"],isChanged:!1,labelLayout:"horizontal",accessKey:"F",readOnly:!0},{type:"button",id:"btnFindStartSkip",align:"left",style:"width:66px",label:f.findStart,isChanged:!1,onClick:function(){var a=this.getDialog();a.getContentElement("spellingcheck","btnFindStartSkip").getElement().getText()==f.findStart?w(a):q(a)}}]},{type:"hbox",widths:["auto",
68],children:[{type:"text",id:"txtChangeWord",widths:[54,"auto"],label:f.changeWord,isChanged:!1,labelLayout:"horizontal"},{type:"button",id:"btnFindSkipContinue",align:"left",style:"width:66px",label:f.findSkipContinue,isChanged:!1,onClick:function(){var a=this.getDialog(),b=k.ignoreWords,c=k.getMatchWord();-1==b.indexOf(c)&&b.push(c);q(a)}}]},{type:"hbox",widths:["auto",68],children:[{type:"hbox",widths:[50,"auto"],children:[{type:"html",html:'\x3cspan style\x3d""\x3e'+f.sugesstWord+"\x3c/span\x3e"},
{type:"html",id:"txtSuggestWordContainer",html:function(){var a=POLARIS.tools.getNextId()+"_suggest_word_label",a=['\x3cdiv class\x3d"polaris_spellingcheck_list_div"\x3e\x3cspan id\x3d"'+a+'" class\x3d"polaris_voice_label"\x3e'+f.headerfooter+"\x3c/span\x3e",'\x3ctable align\x3d"left" role\x3d"listbox" aria-labelledby\x3d"'+a+'" style\x3d"table-layout: fixed; border-collapse: collapse; border-spacing: 0;" cellpadding\x3d"1"',POLARIS.env.ie&&POLARIS.env.quirks?' style\x3d"position:absolute;"':"","\x3e\x3ctbody\x3e"];
a.push("\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e");return a.join("")}(),onClick:function(a){a=a.data.getTarget();"a"!==a.getName()&&(a=a.getAscendant("a"))&&this.getDialog().getContentElement("spellingcheck","txtChangeWord").setValue(a.getText())},style:"border-collapse: separate; overflow:auto;"}]},{type:"vbox",style:"width:68px",children:[{type:"button",id:"btnReplace",align:"left",style:"width:66px",label:f.replace,onClick:function(){var a=this.getDialog(),b=a.getValueOf("spellingcheck","txtChangeWord"),
c=a.getValueOf("spellingcheck","txtFindSpelling");0<b.length?k.replace(a,c,b)||alert(f.notFoundReplaceMsg):alert(f.inputFindComment)}},{type:"button",id:"btnReplaceAll",align:"left",style:"width:66px",label:f.replaceAll,onClick:function(){var a=this.getDialog(),b=a.getValueOf("spellingcheck","txtChangeWord"),c=a.getValueOf("spellingcheck","txtFindSpelling");b?k.replace(a,c,b,!0)||alert(f.notFoundReplaceMsg):alert(f.inputFindComment)}}]}]}]}],onLoad:function(){},onShow:function(){e.fire("changeEditable",
{editable:!0});y(this,!1);var a=e.plugins.spellingcheck.getCheckStart();r=!0;if(a){a=this.getContentElement("spellingcheck","txtFindSpelling");a.setValue("");a.select();var b=this;null==POLARIS.filterDictionary||void 0==POLARIS.filterDictionary?(a=[POLARIS.getUrl(this.path+"words/filterDictionary.js")],POLARIS.loadTemplates(a,function(){w(b)})):w(b)}},onHide:function(){var a;if(a=k.matchRange)a.removeHighlight(),e.focus(),(a=a.toDomRange())&&e.getSelection().selectRanges([a]);x(this);m=null;e.fire("SpellCheckCompleted",
{isSpellingCheckCancled:r})},onFocus:function(){return this.getContentElement("spellingcheck","txtFindSpelling")}}}var D=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}};POLARIS.dialog.add("spellingcheck",function(e){return u(e,"spellingcheck")})})();