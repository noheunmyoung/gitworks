(function(){function F(c){return c.type==POLARIS.NODE_TEXT&&0<c.getLength()&&(!v||!c.isReadOnly())}function y(c){return!(c.type==POLARIS.NODE_ELEMENT&&c.isBlockBoundary(POLARIS.tools.extend({},POLARIS.dtd.$empty,POLARIS.dtd.$nonEditable)))}function q(c,r){function g(a,b){var e=this,c=new POLARIS.dom.walker(a);c.guard=b?y:function(a){!y(a)&&(e._.matchBoundary=!0)};c.evaluator=F;c.breakOnFalse=1;a.startContainer.type==POLARIS.NODE_TEXT&&(this.textNode=a.startContainer,this.offset=a.startOffset-1);this._=
{matchWord:b,walker:c,matchBoundary:!1}}function q(a,b){var e=c.createRange();e.setStart(a.textNode,b?a.offset:a.offset+1);e.setEndAt(c.editable(),POLARIS.POSITION_BEFORE_END);return e}function z(a){var b=c.createRange();b.setStartAt(c.editable(),POLARIS.POSITION_AFTER_START);b.setEnd(a.textNode,a.offset);return b}function w(a){var b=c.getSelection(),e=c.editable();b&&!a?(a=b.getRanges()[0].clone(),a.collapse(!0)):a=c.createRange();a.setStartAt(e,POLARIS.POSITION_AFTER_START);a.setEndAt(e,POLARIS.POSITION_BEFORE_END);
return a}var A=new POLARIS.style(POLARIS.tools.extend({attributes:{"data-polaris-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},c.config.find_highlight,!0));g.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(a){var b=this.textNode;if(null===b)return B.call(this);this._.matchBoundary=!1;if(b&&a&&0<this.offset)this.offset--;else if(b&&!a&&this.offset<b.getLength()-1)this.offset++;else{for(b=null;!b&&!(b=this._.walker[a?"previous":
"next"].call(this._.walker),this._.matchWord&&!b||this._.walker._.end););this.offset=(this.textNode=b)?a?b.getLength()-1:0:0}return B.call(this)}};var u=function(a,b){this._={walker:a,cursors:[],rangeLength:b,highlightRange:null,isMatched:0}};u.prototype={toDomRange:function(){var a=c.createRange(),b=this._.cursors;if(1>b.length){var e=this._.walker.textNode;if(e)a.setStartAfter(e);else return null}else e=b[0],b=b[b.length-1],a.setStart(e.textNode,e.offset),a.setEnd(b.textNode,b.offset+1);return a},
updateFromDomRange:function(a){var b=new g(a);this._.cursors=[];do a=b.next(),a.character&&this._.cursors.push(a);while(a.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var a=this.toDomRange();a.createBookmark();A.applyToRange(a,c);this._.highlightRange=a;var b=a.startContainer;
b.type!=POLARIS.NODE_ELEMENT&&(b=b.getParent());b.scrollIntoView();this.updateFromDomRange(a)}},removeHighlight:function(){if(this._.highlightRange){var a=this._.highlightRange.createBookmark();A.removeFromRange(this._.highlightRange,c);this._.highlightRange.moveToBookmark(a);this.updateFromDomRange(this._.highlightRange);this._.highlightRange=null}},isReadOnly:function(){return this._.highlightRange?this._.highlightRange.startContainer.isReadOnly():0},moveBack:function(){var a=this._.walker.back(),
b=this._.cursors;a.hitMatchBoundary&&(this._.cursors=b=[]);b.unshift(a);b.length>this._.rangeLength&&b.pop();return a},moveNext:function(){var a=this._.walker.next(),b=this._.cursors;a.hitMatchBoundary&&(this._.cursors=b=[]);b.push(a);b.length>this._.rangeLength&&b.shift();return a},getEndCharacter:function(){var a=this._.cursors;return 1>a.length?null:a[a.length-1].character},getStartCharacter:function(){var a=this._.cursors;return 1>a.length?null:a[0].character},getNextCharacterRange:function(a){var b,
e;e=this._.cursors;e=(b=e[e.length-1])&&b.textNode?new g(q(b)):this._.walker;return new u(e,a)},getBeforeCharacterRange:function(a){var b,e;e=(b=this._.cursors[0])&&b.textNode?new g(z(b)):this._.walker;return new u(e,a)},getCursors:function(){return this._.cursors}};var C=function(a,b){var e=[-1];b&&(a=a.toLowerCase());for(var c=0;c<a.length;c++)for(e.push(e[c]+1);0<e[c+1]&&a.charAt(c)!=a.charAt(e[c+1]-1);)e[c+1]=e[e[c+1]-1]+1;this._={overlap:e,state:0,ignoreCase:!!b,pattern:a}};C.prototype={feedCharacter:function(a,
b){this._.ignoreCase&&(a=a.toLowerCase());if("UP"==b)for(;;){if(a==this._.pattern.charAt(this._.pattern.length-1-this._.state))return this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1;if(this._.state)this._.state=this._.overlap[this._.state];else return 0}else for(;;){if(a==this._.pattern.charAt(this._.state))return this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1;if(this._.state)this._.state=this._.overlap[this._.state];else return 0}},reset:function(){this._.state=
0}};var G=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,D=function(a){if(!a)return!0;var b=a.charCodeAt(0);return 9<=b&&13>=b||8192<=b&&8202>=b||G.test(a)},f={searchRange:null,matchRange:null,find:function(a,b,c,d,t,f,l){a=a.replace(/^\s*|\s*$/g,"");this.matchRange?(this.matchRange.removeHighlight(),this.matchRange="UP"==t?this.matchRange.getBeforeCharacterRange(a.length):this.matchRange.getNextCharacterRange(a.length)):this.matchRange=new u(new g(this.searchRange),a.length);
for(var k=new C(a,!b),h=0,n="%";null!==n;){if("UP"==t)for(this.matchRange.moveBack();n=this.matchRange.getStartCharacter();){h=k.feedCharacter(n,t);if(2==h)break;this.matchRange.moveBack().hitMatchBoundary&&k.reset()}else for(this.matchRange.moveNext();n=this.matchRange.getEndCharacter();){h=k.feedCharacter(n,t);if(2==h)break;this.matchRange.moveNext().hitMatchBoundary&&k.reset()}if(2==h){if(c){var m=this.matchRange.getCursors(),p=m[m.length-1],m=z(m[0]),p=q(p);m.trim();p.trim();m=new g(m,!0);p=new g(p,
!0);if(!D(m.back().character)||!D(p.next().character))continue}this.matchRange.setMatched();!1!==f&&this.matchRange.highlight();return!0}}this.matchRange.clearMatched();this.matchRange.removeHighlight();return d&&!l?(this.searchRange=w(1),this.matchRange=null,arguments.callee.apply(this,Array.prototype.slice.call(arguments).concat([!0]))):!1},replaceCounter:0,replace:function(a,b,e,d,f,g,l,k){v=1;a=0;if(this.matchRange&&this.matchRange.isMatched()&&!this.matchRange._.isReplaced&&!this.matchRange.isReadOnly()){this.matchRange.removeHighlight();
b=this.matchRange.toDomRange();e=c.document.createText(e);if(!k){var h=c.getSelection();h.selectRanges([b]);c.fire("saveSnapshot")}b.deleteContents();b.insertNode(e);k||(h.selectRanges([b]),c.fire("saveSnapshot"));this.matchRange.updateFromDomRange(b);k||this.matchRange.highlight();this.matchRange._.isReplaced=!0;this.replaceCounter++;a=1}else a=this.find(b,d,f,g,l,!k);v=0;return a}},d=c.lang.find;return{title:d.title,resizable:POLARIS.DIALOG_RESIZE_NONE,minWidth:418,minHeight:150,buttons:[POLARIS.dialog.okButton(c,
{hidden:!0,onClick:function(){var a=this.getDialog(),b="",b=0==a._.currentTabIndex?a.getValueOf("find","txtFindFind"):a.getValueOf("replace","txtFindReplace");0==b.length?alert(d.inputFindComment):f.find(b,a.getValueOf("find","txtFindCaseChk"),a.getValueOf("find","txtFindWordChk"),a.getValueOf("find","txtFindCyclic"),a.getValueOf("find","txtFindDirection"))||alert(d.notFoundFindMsg)}}),POLARIS.dialog.cancelButton(c,{label:c.lang.common.close})],contents:[{id:"find",label:d.find,title:d.find,accessKey:"",
elements:[{type:"html",html:""},{type:"hbox",widths:["auto",82],children:[{type:"text",id:"txtFindFind",label:d.findWhat,isChanged:!1,labelLayout:"horizontal",widths:[61,"auto"],accessKey:"F"},{type:"button",id:"btnFind",align:"left",style:"width:80px",label:d.find,onClick:function(){var a=this.getDialog();0<a.getValueOf("find","txtFindFind").length?f.find(a.getValueOf("find","txtFindFind"),a.getValueOf("find","txtFindCaseChk"),a.getValueOf("find","txtFindWordChk"),a.getValueOf("find","txtFindCyclic"),
a.getValueOf("find","txtFindDirection"))||alert(d.notFoundFindMsg):alert(d.inputFindComment)}}]},{type:"fieldset",label:POLARIS.tools.htmlEncode(d.findOptions),children:[]},{type:"vbox",className:"vertical-checkbox-table",style:"margin: 3px 0;",children:[{type:"checkbox",style:"padding: 6px 0;",id:"txtFindCaseChk",label:d.matchCase},{type:"checkbox",id:"txtFindWordChk",style:"padding: 6px 0;",label:d.matchWord},{type:"checkbox",id:"txtFindCyclic",style:"padding: 6px 0;","default":!0,label:d.matchCyclic}]},
{type:"fieldset",label:POLARIS.tools.htmlEncode(d.searchDirection),children:[]},{type:"html",html:""},{type:"radio",id:"txtFindDirection",items:[[d.directionUp,"UP"],[d.directionDown,"DOWN"]],"default":"DOWN",widths:[0,"auto"],label:"",style:"padding: 6px 0;",labelLayout:"horizontal"},{type:"html",html:""}]},{id:"replace",label:d.replace,accessKey:"M",elements:[{type:"html",html:""},{type:"hbox",widths:["auto",82],children:[{type:"text",id:"txtFindReplace",widths:[61,"auto"],label:d.findWhat,isChanged:!1,
labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFindReplace",align:"left",style:"width:80px",label:d.replace,onClick:function(){var a=this.getDialog();0<a.getValueOf("replace","txtFindReplace").length?f.replace(a,a.getValueOf("replace","txtFindReplace"),a.getValueOf("replace","txtReplace"),a.getValueOf("replace","txtReplaceCaseChk"),a.getValueOf("replace","txtReplaceWordChk"),a.getValueOf("replace","txtReplaceCyclic"),a.getValueOf("replace","txtReplaceDirection"))||alert(d.notFoundReplaceMsg):
alert(d.inputFindComment)}}]},{type:"hbox",widths:["auto",82],children:[{type:"text",id:"txtReplace",widths:[61,"auto"],label:d.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",id:"btnReplaceAll",align:"left",style:"width:80px",label:d.replaceAll,isChanged:!1,onClick:function(){var a=this.getDialog();f.replaceCounter=0;f.searchRange=w(1);f.matchRange&&(f.matchRange.removeHighlight(),f.matchRange=null);c.fire("saveSnapshot");if(0<a.getValueOf("replace","txtFindReplace").length){for(;f.replace(a,
a.getValueOf("replace","txtFindReplace"),a.getValueOf("replace","txtReplace"),a.getValueOf("replace","txtReplaceCaseChk"),a.getValueOf("replace","txtReplaceWordChk"),!1,"DOWN",!0););f.replaceCounter?(alert(d.replaceSuccessMsg.replace(/%1/,f.replaceCounter)),c.fire("saveSnapshot")):alert(d.notFoundReplaceMsg)}else alert(d.inputFindComment)}}]},{type:"fieldset",label:POLARIS.tools.htmlEncode(d.findOptions),children:[]},{type:"vbox",className:"vertical-checkbox-table",style:"margin: 3px 0;",children:[{type:"checkbox",
style:"padding: 6px 0;",id:"txtReplaceCaseChk",label:d.matchCase},{type:"checkbox",style:"padding: 6px 0;",id:"txtReplaceWordChk",label:d.matchWord},{type:"checkbox",style:"padding: 6px 0;",id:"txtReplaceCyclic","default":!0,label:d.matchCyclic}]},{type:"fieldset",label:POLARIS.tools.htmlEncode(d.searchDirection),children:[]},{type:"html",html:""},{type:"radio",id:"txtReplaceDirection",items:[[d.directionUp,"UP"],[d.directionDown,"DOWN"]],"default":"DOWN",widths:[0,"auto"],label:"",style:"padding: 6px 0;",
labelLayout:"horizontal"},{type:"html",html:""}]}],onLoad:function(){var a=this,b,c=0;this.on("hide",function(){c=0});this.on("show",function(){c=1});this.selectPage=POLARIS.tools.override(this.selectPage,function(d){return function(f){d.call(a,f);var g=a._.tabs[f],l;l="find"===f?"txtFindWordChk":"txtReplaceWordChk";b=a.getContentElement(f,"find"===f?"txtFindFind":"txtFindReplace");a.getContentElement(f,l);g.initialized||(POLARIS.document.getById(b._.inputId),g.initialized=!0);if(c){var k;f="find"===
f?1:0;var g=1-f,h,n=x.length;for(h=0;h<n;h++)l=this.getContentElement(E[f],x[h][f]),k=this.getContentElement(E[g],x[h][g]),k.setValue(l.getValue())}}})},onShow:function(){f.searchRange=w();var a=this.getParentEditor().getSelection().getSelectedText(),b=this.getContentElement(r,"find"==r?"txtFindFind":"txtFindReplace");b.setValue(a);b.select();this.selectPage(r);this[("find"==r&&this._.editor.readOnly?"hide":"show")+"Page"]("replace")},onHide:function(){var a;f.matchRange&&f.matchRange.isMatched()&&
(f.matchRange.removeHighlight(),c.focus(),(a=f.matchRange.toDomRange())&&c.getSelection().selectRanges([a]));delete f.matchRange;a=c.document.find('[data-polaris-bookmark\x3d"1"]');for(var b=0;b<a.count();b++)a.getItem(b).remove()},onFocus:function(){return"replace"==r?this.getContentElement("replace","txtFindReplace"):this.getContentElement("find","txtFindFind")}}}var v,B=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):
null,hitMatchBoundary:this._.matchBoundary}},E=["find","replace"],x=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"],["txtFindDirection","txtReplaceDirection"]];POLARIS.dialog.add("find",function(c){return q(c,"find")});POLARIS.dialog.add("replace",function(c){return q(c,"replace")})})();