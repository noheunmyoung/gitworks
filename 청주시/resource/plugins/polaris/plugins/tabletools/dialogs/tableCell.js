POLARIS.dialog.add("cellProperties",function(d){function w(a,b){POLARIS.tools.isEmptyValue(b)&&(b="px");return POLARIS.tools.convertToUnit(a.getStyle("width"),b,2)}function m(a){return function(b,c){for(var d=a(b[0],c),e=1;e<b.length;e++)if(a(b[e],c)!==d){d=null;break}"undefined"!=typeof d&&(this.setValue(d),POLARIS.env.gecko&&"select"==this.type&&!d&&(this.getInputElement().$.selectedIndex=-1))}}function t(a,b,c){return function(){var d=this.getValue(),d=!!(POLARIS.dialog.validate.number()(d)&&d>=
b&&d<c+1);d||(alert(a.replace("%1",c)),this.select());return d}}function D(){if(!this.cells||0==this.cells.length)return null;var a=d.plugins.tablecellblock,b=a.isSelected()&&1<this.cells.length,c=a.getSelectedRange(),h=a=this.cells[0];b&&(h=c.isForward?c.endCell:c.startCell);var e={backgroundColor:a.getStyle("background-color"),border:{top:{style:a.getStyle("border-top-style"),width:a.getStyle("border-top-width"),color:a.getStyle("border-top-color")},left:{style:a.getStyle("border-left-style"),width:a.getStyle("border-left-width"),
color:a.getStyle("border-left-color")},bottom:{style:l?h.getStyle("border-bottom-style"):a.getStyle("border-bottom-style"),width:l?h.getStyle("border-bottom-width"):a.getStyle("border-bottom-width"),color:l?h.getStyle("border-bottom-color"):a.getStyle("border-bottom-color")},right:{style:l?h.getStyle("border-right-style"):a.getStyle("border-right-style"),width:l?h.getStyle("border-right-width"):a.getStyle("border-right-width"),color:l?h.getStyle("border-right-color"):a.getStyle("border-right-color")}}};
b&&this.cells.forEach(function(a){e.backgroundColor!==a.getStyle("background-color")&&(e.backgroundColor=null);var b={left:l?c.indexRange.col[0]==a._index[1]:!0,right:l?c.indexRange.col[1]==a._index[1]+a._colSpan-1:!0,top:l?c.indexRange.row[0]==a._index[0]:!0,bottom:l?c.indexRange.row[1]==a._index[0]+a._rowSpan-1:!0};Object.keys(b).forEach(function(c){1==b[c]&&(e.border[c].style!==a.getStyle("border-"+c+"-style")&&(e.border[c].style=null),e.border[c].width!==a.getStyle("border-"+c+"-width")&&(e.border[c].width=
null),e.border[c].color!==a.getStyle("border-"+c+"-color")&&(e.border[c].color=null))})});return e}function x(a,b){var c=d.plugins.tablecellblock;if(!a||!b)return!1;if(0==l||!c.isSelected())return!0;var c=c.getSelectedRange().indexRange,h=!1;switch(b){case "left":h=c.col[0]==a._index[1];break;case "right":h=c.col[1]==a._index[1]+a._colSpan-1;break;case "top":h=c.row[0]==a._index[0];break;case "bottom":h=c.row[1]==a._index[0]+a._rowSpan-1}return h}function y(a,b,c,d){var e=d.length-1,g=d[e].length-
1,p,k;switch(b){case "left":p=[a.row[0],a.row[1]];k=[Math.max(a.col[0]-1,0),Math.max(a.col[0]-1,0)];break;case "right":p=[a.row[0],a.row[1]];k=[Math.min(a.col[1]+1,g),Math.min(a.col[1]+1,g)];break;case "top":p=[Math.max(a.row[0]-1,0),Math.max(a.row[0]-1,0)];k=[a.col[0],a.col[1]];break;case "bottom":p=[Math.min(a.row[1]+1,e),Math.min(a.row[1]+1,e)],k=[a.col[0],a.col[1]]}for(var f=[],e=function(a){return-1==POLARIS.tools.indexOfElement(f,a)},g=p[0];g<=p[1];g++)for(var r=k[0];r<=k[1];r++)if(!(a.row[0]<=
g&&a.row[1]>=g&&a.col[0]<=r&&a.col[1]>=r)){var q=d[g][r];if(q){var q=new POLARIS.dom.element(q),q=POLARIS.tools.tableMap.findSplitedCells(q,c),u=POLARIS.tools.tableMap.getSplitedCellIndexRange(q,d),l=!1;switch(b){case "left":case "right":l=p[0]<=u.row[0]&&p[1]>=u.row[1];break;case "top":case "bottom":l=k[0]<=u.col[0]&&k[1]>=u.col[1]}l&&(f=f.concat(q.filter(e)))}}return f}function E(a,b,c,h){c.forEach(function(a){a.removeAttribute("border")});var e=this.getContentElement("background","selBorderStyle").getValue(),
g=this.getContentElement("background","borderColorChoose").getValue(),p=this.getContentElement("background","selBorderWidth").getValue(),k=d.plugins.tablecellblock;if(l&&k.isSelected()&&!k.isSelectedSingle()){var f=k.getSelectedRange().indexRange;Object.keys(a).forEach(function(d){1==a[d]&&(b.forEach(function(a){x(a,d)&&(a.setStyle("border-"+d+"-style",e),a.setStyle("border-"+d+"-color",g),a.setStyle("border-"+d+"-width",p),a.removeAttribute("borderColor"))}),y(f,d,c,h).forEach(function(a){var b;
switch(d){case "left":b="right";break;case "right":b="left";break;case "top":b="bottom";break;case "bottom":b="top"}a.setStyle("border-"+b+"-style",e);a.setStyle("border-"+b+"-color",g);a.setStyle("border-"+b+"-width",p);a.removeAttribute("borderColor")}))})}else Object.keys(a).forEach(function(d){1==a[d]&&b.forEach(function(a){x(a,d)&&(a.setStyle("border-"+d+"-style",e),a.setStyle("border-"+d+"-color",g),a.setStyle("border-"+d+"-width",p),a.removeAttribute("borderColor"),a=POLARIS.tools.tableMap.findSplitedCells(a,
c),a=POLARIS.tools.tableMap.getSplitedCellIndexRange(a,h),y(a,d,c,h).forEach(function(a){var b;switch(d){case "left":b="right";break;case "right":b="left";break;case "top":b="bottom";break;case "bottom":b="top"}a.setStyle("border-"+b+"-style",e);a.setStyle("border-"+b+"-color",g);a.setStyle("border-"+b+"-width",p);a.removeAttribute("borderColor")}))})})}function F(a,b,c,d){var e=0,g=0;a.forEach(function(a){var k=a[1];for(a=0;a<c.length;a+=1){var f=new POLARIS.dom.element(c[a][k]);f&&(0===a&&(e+=parseFloat(w(f,
"mm")),g+=b),isNaN(b)?f.removeStyle("width"):f.setStyle("width",b+"mm"),f.removeAttribute("width"))}d.forEach(function(a){if(a=(a=(a=a.findOne("colgroup"))&&a.find("col"))&&a.getItem(k))a.setStyle("width",b+"mm"),a.hasAttribute("width")&&a.removeAttribute("width")})});d.forEach(function(a){var b=parseFloat(w(a,"mm"))-(e-g);a.setStyle("width",b+"mm")})}var v=d.lang.table,f=v.cell,n=d.lang.common,z=POLARIS.dialog.validate,l=POLARIS.plugins.tabletools.getIsApplyAsSingleCell(),A=d.plugins.uicolor,B=!1,
C=!1;return{title:f.title,minWidth:292,minHeight:80,resizable:POLARIS.DIALOG_RESIZE_NONE,contents:[{id:"info",label:d.lang.common.generalTab,accessKey:"I",elements:[{type:"vbox",children:[{type:"fieldset",label:n.size,style:"margin-top: 10px;",children:[]},{type:"hbox",widths:["50%","50%"],children:[{type:"html",html:n.width},{type:"html",html:n.height}]},{type:"hbox",widths:["50%","50%"],children:[{type:"hbox",widths:["auto","32px"],children:[{type:"text",id:"width","default":"",validate:z.number(d.lang.common.invalidWidth),
maxLength:5,setup:m(function(a){a=parseFloat(w(a,"mm"));return POLARIS.tools.isFloat(a)?a.toFixed(1):a}),commit:function(){}},{type:"html",html:d.lang.common.unitMm,style:"line-height: 26px;"}]},{type:"hbox",widths:["auto","32px"],children:[{type:"text",id:"height","default":"",maxLength:5,validate:z.number(f.invalidHeight),setup:m(function(a){var b=parseFloat,c="mm";POLARIS.tools.isEmptyValue(c)&&(c="px");a=POLARIS.tools.convertToUnit(a.getStyle("height"),c,2);b=b(a);return POLARIS.tools.isFloat(b)?
b.toFixed(1):b}),commit:function(a){function b(a,b){isNaN(b)?a.removeStyle("height"):a.setStyle("height",b+d.lang.common.unitMm);a.removeAttribute("height")}if(this.isChanged()){var c=parseFloat(this.getValue());a=a.getParent();for(var h=0;h<a.getChildCount();h+=1){var e=a.getChild(h);b(e,c)}b(a,c)}}},{type:"html",html:d.lang.common.unitMm,style:"line-height: 26px;"}]}]},{type:"html",id:"notiBlockResize",html:'\x3cspan style\x3d"color: red;"\x3e'+f.notiBlockResize+"\x3c/span\x3e"},{type:"html",id:"notiBlockWidth",
html:'\x3cspan style\x3d"color: red;"\x3e'+f.notiBlockWidth+"\x3c/span\x3e"},{type:"html",id:"notiBlockHeight",html:'\x3cspan style\x3d"color: red;"\x3e'+f.notiBlockHeight+"\x3c/span\x3e"},{type:"fieldset",label:f.align,style:"margin-top: 10px;",children:[]},{type:"hbox",widths:["50%","50%"],children:[{type:"select",id:"hAlign",label:f.hAlign,"default":"",items:[[n.notSet,""],[n.alignLeft,"left"],[n.alignCenter,"center"],[n.alignRight,"right"]],setup:m(function(a){var b=a.getAttribute("align");return a.getStyle("text-align")||
b||""}),commit:function(a){if(0!=this.isChanged()){var b=this.getValue();b?a.setStyle("text-align",b):a.removeStyle("text-align");a.removeAttribute("align");a=a.find("p, li, table");var c,d=a.count();for(c=0;c<d;c++){var e=a.getItem(c);e.is("p","li")?b?e.setStyle("text-align",b):e.removeStyle("text-align"):e.is("table")&&(b?"left"==b?e.removeAttribute("align"):e.setAttribute("align",b):e.removeAttribute("align"))}}}},{type:"select",id:"vAlign",label:f.vAlign,"default":"",items:[[n.notSet,""],[n.alignTop,
"top"],[n.alignMiddle,"middle"],[n.alignBottom,"bottom"]],setup:m(function(a){var b=a.getAttribute("valign");a=a.getStyle("vertical-align");switch(a){case "top":case "middle":case "bottom":case "baseline":break;default:a=""}return a||b||""}),commit:function(a){if(0!=this.isChanged()){var b=this.getValue();b?a.setStyle("vertical-align",b):a.removeStyle("vertical-align");a.removeAttribute("valign")}}}]},{type:"fieldset",label:d.lang.table.cellPad,style:"margin-top: 10px;",children:[]},{type:"hbox",
styles:["vertical-align:top"],children:[{type:"hbox",widths:["44px","auto","30px"],children:[{type:"html",html:d.lang.table.cellPadding.left,style:"line-height: 26px;"},{type:"text",id:"txtCellPadLeft",maxLength:5,requiredContent:"td{padding-left}","default":"2",validate:t(d.lang.table.invalidCellPadding,0,21),setup:m(function(a){a=a.getStyle("padding-left");return-1==a.indexOf("mm")?"0":parseFloat(a)+""}),commit:function(a){0!=this.isChanged()&&this.getValue()&&a.setStyle("padding-left",this.getValue()+
d.lang.common.unitMm)}},{type:"html",html:d.lang.common.unitMm,style:"line-height: 26px;"}]},{type:"hbox",widths:["44px","auto","30px"],children:[{type:"html",html:d.lang.table.cellPadding.top,style:"line-height: 26px;"},{type:"text",id:"txtCellPadTop",maxLength:5,requiredContent:"td{padding-top}","default":"0",validate:t(d.lang.table.invalidCellPadding,0,21),setup:m(function(a){a=a.getStyle("padding-top");return-1==a.indexOf("mm")?"0":parseFloat(a)+""}),commit:function(a){0!=this.isChanged()&&this.getValue()&&
a.setStyle("padding-top",this.getValue()+d.lang.common.unitMm)}},{type:"html",html:d.lang.common.unitMm,style:"line-height: 26px;"}]}]},{type:"hbox",styles:["vertical-align:top"],children:[{type:"hbox",widths:["44px","auto","30px"],children:[{type:"html",html:d.lang.table.cellPadding.right,style:"line-height: 26px;"},{type:"text",id:"txtCellPadRight",maxLength:5,requiredContent:"td{padding-right}","default":"2",validate:t(d.lang.table.invalidCellPadding,0,21),setup:m(function(a){a=a.getStyle("padding-right");
return-1==a.indexOf("mm")?"0":parseFloat(a)+""}),commit:function(a){0!=this.isChanged()&&this.getValue()&&a.setStyle("padding-right",this.getValue()+d.lang.common.unitMm)}},{type:"html",html:d.lang.common.unitMm,style:"line-height: 26px;"}]},{type:"hbox",widths:["44px","auto","30px"],children:[{type:"html",html:d.lang.table.cellPadding.bottom,style:"line-height: 26px;"},{type:"text",id:"txtCellPadBottom",maxLength:5,requiredContent:"td{padding-bottom}","default":"0",validate:t(d.lang.table.invalidCellPadding,
0,21),setup:m(function(a){a=a.getStyle("padding-bottom");return-1==a.indexOf("mm")?"0":parseFloat(a)+""}),commit:function(a){0!=this.isChanged()&&this.getValue()&&a.setStyle("padding-bottom",this.getValue()+d.lang.common.unitMm)}},{type:"html",html:d.lang.common.unitMm,style:"line-height: 26px;"}]}]}]}]},{id:"background",label:d.lang.label.label_cellBg,elements:[{type:"fieldset",label:f.borderAndBackgroudColor,style:"margin-top: 10px;",children:[]},{type:"hbox",widths:["50%","50%"],children:[{type:"select",
id:"selBorderWidth",label:f.borderWidth,items:[[d.lang.table.borderWidth[0][0],d.lang.table.borderWidth[0][1]],[d.lang.table.borderWidth[1][0],d.lang.table.borderWidth[1][1]],[d.lang.table.borderWidth[2][0],d.lang.table.borderWidth[2][1]],[d.lang.table.borderWidth[3][0],d.lang.table.borderWidth[3][1]],[d.lang.table.borderWidth[4][0],d.lang.table.borderWidth[4][1]],[d.lang.table.borderWidth[5][0],d.lang.table.borderWidth[5][1]],[d.lang.table.borderWidth[6][0],d.lang.table.borderWidth[6][1]],[d.lang.table.borderWidth[7][0],
d.lang.table.borderWidth[7][1]],[d.lang.table.borderWidth[8][0],d.lang.table.borderWidth[8][1]],[d.lang.table.borderWidth[9][0],d.lang.table.borderWidth[9][1]],[d.lang.table.borderWidth[10][0],d.lang.table.borderWidth[10][1]],[d.lang.table.borderWidth[11][0],d.lang.table.borderWidth[11][1]],[d.lang.table.borderWidth[12][0],d.lang.table.borderWidth[12][1]],[d.lang.table.borderWidth[13][0],d.lang.table.borderWidth[13][1]],[d.lang.table.borderWidth[14][0],d.lang.table.borderWidth[14][1]],[d.lang.table.borderWidth[15][0],
d.lang.table.borderWidth[15][1]],[d.lang.table.borderWidth[16][0],d.lang.table.borderWidth[16][1]]],setup:function(){var a=this.getDialog().cellStyle.border,b=a.top.width;Object.keys(a).forEach(function(c){b!==a[c].width&&(b=null)});if(b)for(var c=d.lang.table.borderWidth,b=POLARIS.tools.convertToUnit(b,"mm",2),h=parseFloat(b),e=0,g=100;e<c.length;e++){var f=c[e][0],k=Math.abs(h-parseFloat(f));if(g>k)g=k,b=f;else break}else b="0.12mm";this.setValue(b)},onChange:function(){var a=this.getDialog(),b=
POLARIS.document.getById("polaris_tablecell_preview"),c=a.getContentElement("background","borderTop").getValue(),d=a.getContentElement("background","borderBottom").getValue(),e=a.getContentElement("background","borderLeft").getValue(),a=a.getContentElement("background","borderRight").getValue(),g=this.getValue();1==c&&b.setStyle("border-top-width",g);1==d&&b.setStyle("border-bottom-width",g);1==e&&b.setStyle("border-left-width",g);1==a&&b.setStyle("border-right-width",g)},commit:function(){}},{id:"selBorderStyle",
type:"select","default":"",label:f.borderStyle,items:[[d.lang.table.borderStyle.border_none,"none"],[d.lang.table.borderStyle.border_solid,"solid"],[d.lang.table.borderStyle.border_double,"double"],[d.lang.table.borderStyle.border_dashed,"dashed"],[d.lang.table.borderStyle.border_dotted,"dotted"]],setup:function(){var a=this.getDialog().cellStyle.border,b=a.top.style;Object.keys(a).forEach(function(c){b!==a[c].style&&(b=null)});if(!b||"none"!==b&&"solid"!==b&&"double"!==b&&"dashed"!==b&&"dotted"!==
b)b="solid";this.setValue(b)},onChange:function(){var a=this.getDialog(),b=POLARIS.document.getById("polaris_tablecell_preview"),c=a.getContentElement("background","borderTop").getValue(),d=a.getContentElement("background","borderBottom").getValue(),e=a.getContentElement("background","borderLeft").getValue(),a=a.getContentElement("background","borderRight").getValue(),g=this.getValue();1==c&&b.setStyle("border-top-style",g);1==d&&b.setStyle("border-bottom-style",g);1==e&&b.setStyle("border-left-style",
g);1==a&&b.setStyle("border-right-style",g)},commit:function(){}}]},{type:"hbox",widths:["50%","50%"],children:[{type:"vbox",children:[{type:"html",id:"bgColor",html:"\x3cspan\x3e"+f.bgColor+"\x3c/span\x3e"},{type:"vbox",className:"color_choose_parent",children:[{type:"button",id:"bgColorChoose","class":"colorChooser",label:"",setup:function(){var a=this.getDialog().cellStyle.backgroundColor;a||(a="#ffffff");this.setValue(a)},onLoad:function(){this.getElement().getParent().setStyle("vertical-align",
"bottom");this.on("change",function(a){a=a.data.value;POLARIS.document.getById("polaris_tablecell_preview").setStyle("background-color",a);this.getElement().setStyle("background-color",a)})},onClick:function(){A&&d.getUIColorFromDialog(function(a){a&&!this.getDialog().getContentElement("background","noBackgroundColor").getValue()&&this.setValue(a)},this)},isChanged:function(){return this.getValue()!==this.getInitValue()},setInitValue:function(){this._.initValue=this.getValue()},getInitValue:function(){return this._.initValue},
commit:function(a){if(0!=this.isChanged()&&!this.getDialog().getContentElement("background","noBackgroundColor").getValue()){var b=this.getValue();b?a.setStyle("background-color",b):a.removeStyle("background-color");a.removeAttribute("bgColor")}}}]}]},{type:"vbox",children:[{type:"html",id:"bgColor",html:"\x3cspan\x3e"+f.borderColor+"\x3c/span\x3e"},{type:"vbox",className:"color_choose_parent",children:[{type:"button",id:"borderColorChoose","class":"colorChooser",label:"",setup:function(){var a=this.getDialog().cellStyle.border,
b=a.top.color;Object.keys(a).forEach(function(c){b!==a[c].color&&(b=null)});b||(b="#000000");this.setValue(b)},onLoad:function(){this.getElement().getParent().setStyle("vertical-align","bottom");this.on("change",function(a){a=a.data.value;this.getElement().setStyle("background-color",a)})},onClick:function(){A&&d.getUIColorFromDialog(function(a){a&&(this.setValue(a),this.onChange())},this)},isChanged:function(){return this.getValue()!==this.getInitValue()},setInitValue:function(){this._.initValue=
this.getValue()},getInitValue:function(){return this._.initValue},onChange:function(){var a=this.getDialog(),b=POLARIS.document.getById("polaris_tablecell_preview"),c=a.getContentElement("background","borderTop").getValue(),d=a.getContentElement("background","borderBottom").getValue(),e=a.getContentElement("background","borderLeft").getValue(),a=a.getContentElement("background","borderRight").getValue(),g=this.getValue();1==c&&b.setStyle("border-top-color",g);1==d&&b.setStyle("border-bottom-color",
g);1==e&&b.setStyle("border-left-color",g);1==a&&b.setStyle("border-right-color",g)},commit:function(){}}]}]}]},{type:"checkbox",id:"noBackgroundColor","default":!1,label:v.noBackgroundColor,setup:function(a){return!1},onChange:function(){POLARIS.document.getById("polaris_tablecell_preview").removeStyle("background-color");var a=this.getDialog().getContentElement("background","bgColorChoose");a.getElement().setStyle("background-color","");a.setValue("#ffffff")},commit:function(a){0!=this.isChanged()&&
this.getValue()&&(a.removeStyle("background-color"),a.removeAttribute("bgColor"))}},{type:"fieldset",id:"imageFieldSet",label:d.lang.table.bgImage,style:"margin-top: 10px;",hidden:l||d.config.useImageBase64Encoding,setup:function(a){this.hidden=l||d.config.useImageBase64Encoding;a=this.getElement();var b=a.getAscendant("td",!0);1==l||d.config.useImageBase64Encoding?(a.hide(),b.removeClass("polaris_dialog_ui_vbox_child")):(a.show(),b.addClass("polaris_dialog_ui_vbox_child"))},children:[]},{type:"hbox",
id:"imagebox",hidden:l||d.config.useImageBase64Encoding,setup:function(a){this.hidden=l||d.config.useImageBase64Encoding;a=this.getElement();var b=a.getAscendant("td",!0);1==l||d.config.useImageBase64Encoding?(a.hide(),b.removeClass("polaris_dialog_ui_vbox_child")):(a.show(),b.addClass("polaris_dialog_ui_vbox_child"))},children:[{id:"txtPath",type:"text",style:"width: 199px;",label:"",required:!0,setup:m(function(a){a=a.getComputedStyle("background-image")||"";return a="none"==a?"":a.replace(/url\(\s*(["']?)\s*([^\)]*)\s*\1\s*\)/i,
function(a,c,d){return d})}),commit:function(a){var b=this.getDialog().getContentElement("background","noBackgroundImage").getValue();0==this.isChanged()||b||((b=this.getValue())?(b=b.replace(/ /g,"%20"),a.setStyle("background-image","url("+b+")"),a.setStyle("background-size","100% 100%")):a.removeStyle("background-image"))}},{type:"vbox",filebrowser:"uploadButton",label:d.lang.image.upload,style:"width: 87px;",className:"upload_button_parent",children:[{type:"file",id:"upload",style:"width:100%",
hidden:!0,label:d.lang.image.btnUpload,size:38},{type:"fileButton",id:"uploadButton",style:"width:100%",filebrowser:"background:txtPath",label:d.lang.image.btnUpload,"for":["background","upload"]}]}]},{type:"checkbox",id:"noBackgroundImage","default":!1,label:v.noBackgroundImage,commit:function(a){0!=this.isChanged()&&this.getValue()&&(a.removeStyle("background-image"),a.removeStyle("background-size"))}},{type:"vbox",children:[{type:"html",html:"\x3cspan\x3e"+f.borderSelection+"\x3c/span\x3e"},{type:"vbox",
style:"border: 1px solid #a0a2ab; border-radius: 2px; background-color: #fffeff; padding: 5px; height: 100%;",textalign:"center",className:"preview_box",children:[{type:"html",html:'\x3cspan style\x3d"text-align:center; vertical-align: middle;"\x3e'+f.borderSelectionInfo+"\x3c/span\x3e"},{type:"checkbox",id:"borderTop",label:"",onClick:function(){var a=this.getDialog(),b=POLARIS.document.getById("polaris_tablecell_preview");if(this.getValue()){var c=a.getContentElement("background","borderColorChoose").getValue(),
d=a.getContentElement("background","selBorderStyle").getValue(),a=a.getContentElement("background","selBorderWidth").getValue();!POLARIS.env.chrome||"#000000"!=c&&"rgb(0, 0, 0)"!=c||(c=null);b.setStyle("border-top-color",c);b.setStyle("border-top-style",d);b.setStyle("border-top-width",a)}else c=a.cellStyle.border.top,c.style&&c.width&&c.color?(b.setStyle("border-top-style",c.style),b.setStyle("border-top-width",c.width),b.setStyle("border-top-color",c.color)):(b.removeStyle("border-top-style"),b.removeStyle("border-top-width"),
b.setStyle("border-top-color","#ffffff"))},commit:function(){}},{type:"hbox",verticalalign:"middle",widths:["50%","32px","50%"],children:[{type:"checkbox",id:"borderLeft",style:"float:right;",label:"",onClick:function(){var a=this.getDialog(),b=POLARIS.document.getById("polaris_tablecell_preview");if(this.getValue()){var c=a.getContentElement("background","borderColorChoose").getValue(),d=a.getContentElement("background","selBorderStyle").getValue(),a=a.getContentElement("background","selBorderWidth").getValue();
!POLARIS.env.chrome||"#000000"!=c&&"rgb(0, 0, 0)"!=c||(c=null);b.setStyle("border-left-color",c);b.setStyle("border-left-style",d);b.setStyle("border-left-width",a)}else c=a.cellStyle.border.left,c.style&&c.width&&c.color?(b.setStyle("border-left-style",c.style),b.setStyle("border-left-width",c.width),b.setStyle("border-left-color",c.color)):(b.removeStyle("border-left-style"),b.removeStyle("border-left-width"),b.setStyle("border-left-color","#ffffff"))},commit:function(){}},{id:"borderPreview",type:"html",
html:'\x3cdiv id\x3d"polaris_tablecell_preview" style\x3d"width: 32px; height: 32px;"\x3e\x3c/div\x3e',setup:function(){var a=POLARIS.document.getById("polaris_tablecell_preview"),b=this.getDialog().cellStyle.border;Object.keys(b).forEach(function(c){b[c].style&&b[c].width&&b[c].color?(a.setStyle("border-"+c+"-style",b[c].style),a.setStyle("border-"+c+"-width",b[c].width),a.setStyle("border-"+c+"-color",b[c].color)):(a.removeStyle("border-"+c+"-style"),a.removeStyle("border-"+c+"-width"),a.setStyle("border-"+
c+"-color","#ffffff"))});a.removeAttribute("border")}},{type:"checkbox",id:"borderRight",style:"float:left;",label:"",onClick:function(){var a=this.getDialog(),b=POLARIS.document.getById("polaris_tablecell_preview");if(this.getValue()){var c=a.getContentElement("background","borderColorChoose").getValue(),d=a.getContentElement("background","selBorderStyle").getValue(),a=a.getContentElement("background","selBorderWidth").getValue();!POLARIS.env.chrome||"#000000"!=c&&"rgb(0, 0, 0)"!=c||(c=null);b.setStyle("border-right-color",
c);b.setStyle("border-right-style",d);b.setStyle("border-right-width",a)}else c=a.cellStyle.border.right,c.style&&c.width&&c.color?(b.setStyle("border-right-style",c.style),b.setStyle("border-right-width",c.width),b.setStyle("border-right-color",c.color)):(b.removeStyle("border-right-style"),b.removeStyle("border-right-width"),b.setStyle("border-right-color","#ffffff"))},commit:function(){}}]},{type:"checkbox",id:"borderBottom",label:"",onClick:function(){var a=this.getDialog(),b=POLARIS.document.getById("polaris_tablecell_preview");
if(this.getValue()){var c=a.getContentElement("background","borderColorChoose").getValue(),d=a.getContentElement("background","selBorderStyle").getValue(),a=a.getContentElement("background","selBorderWidth").getValue();!POLARIS.env.chrome||"#000000"!=c&&"rgb(0, 0, 0)"!=c||(c=null);b.setStyle("border-bottom-color",c);b.setStyle("border-bottom-style",d);b.setStyle("border-bottom-width",a)}else c=a.cellStyle.border.bottom,c.style&&c.width&&c.color?(b.setStyle("border-bottom-style",c.style),b.setStyle("border-bottom-width",
c.width),b.setStyle("border-bottom-color",c.color)):(b.removeStyle("border-bottom-style"),b.removeStyle("border-bottom-width"),b.setStyle("border-bottom-color","#ffffff"))},commit:function(){}}]}]}]},{id:"advanced",label:d.lang.common.advancedTab,elements:[{type:"radio",id:"cellType",hidden:!0,label:f.cellType,"default":"td",items:[[f.data,"td"],[f.header,"th"]],setup:m(function(a){return a.getName()}),commit:function(a){0!=this.isChanged()&&a.renameNode(this.getValue())}},{type:"radio",id:"contentEditable",
label:f.cellLock,"default":"no",items:[[f.yes,"yes"],[f.no,"no"]],setup:m(function(a){return"false"==a.getAttribute("contentEditable")?"yes":"no"}),commit:function(a){var b=null,c=0,h=null;if(0!=this.isChanged())if("yes"==this.getValue())B=!0,POLARIS.env.ie&&(c='\x3cdiv style\x3d"width:100%;" unselectable\x3d"on" contentEditable\x3d"false" doc-data-protected\x3d"true"\x3e'+a.$.innerHTML+"\x3c/div\x3e",a.$.innerHTML=c,d.getSelection().removeAllRanges()),a.setAttribute("contentEditable","false"),a.setAttribute("doc-data-protected",
"true");else{if(POLARIS.env.ie)for((b=a.getFirst())&&"DIV"==b.$.nodeName&&(a.$.innerHTML=b.$.innerHTML),b=a.find('[contenteditable\x3d"false"]');c<b.count();c+=1)h=b.getItem(c),h.removeAttribute("contentEditable"),h.removeAttribute("unselectable");a.removeAttribute("contentEditable");a.removeAttribute("doc-data-protected","false")}}},{type:"vbox",children:[{type:"text",id:"cellField",width:"100%",label:f.cellField,"default":"",maxLength:100,setup:m(function(a){var b=a.findOne("[doc-data-field]");
return b?b.getAttribute("doc-data-field"):a.getAttribute("doc-data-field")}),commit:function(a){if(0!=this.isChanged()){var b=a.findOne("[doc-data-field]");a=b?b:a;b=this.getValue();null==b||0==b.length?(a.removeAttribute("doc-data-field"),a.removeAttribute("contentEditable")):a.setAttribute("doc-data-field",this.getValue())}}},{type:"checkbox",id:"cellFieldEditable",width:"100%",label:f.cellFieldEditable,"default":!1,validate:function(){if(1==this.getValue()){var a=this.getDialog().getContentElement("advanced",
"cellField").getValue();a&&(a=a.replace(/^\s+|\s+$/gm,""));if(""==a)return alert(v.noFieldNameForFieldEditable),!1}return!0},setup:m(function(a){var b=a.findOne("[doc-data-field]");return"true"==(b?b:a).getAttribute("doc-data-field-editable")?!0:!1}),commit:function(a){if(0!=this.isChanged()){var b=a.findOne("[doc-data-field]");a=b?b:a;0==a.hasAttribute("doc-data-field")?a.removeAttribute("doc-data-field-editable"):this.getValue()?a.setAttribute("doc-data-field-editable",!0):a.setAttribute("doc-data-field-editable",
!1)}}}]}]}],onShow:function(){function a(a){return function(b){return(b=b.getAttribute(a))&&1<parseInt(b)}}var b,c,h,e,g;l=POLARIS.plugins.tabletools.getIsApplyAsSingleCell();this.cells=POLARIS.plugins.tabletools.getFocusedTableCells(this._.editor);this.cellStyle=D.call(this);C=1<this.cells.length?!0:!1;(l||POLARIS.plugins.tabletools.getIsApplyForEachCell())&&this.selectPage("background");this.setupContent(this.cells,this.cells.length);b=this.getContentElement("advanced","cellField");c=this.getContentElement("advanced",
"cellFieldEditable");1==d.config.editMode||2==d.config.editMode?(b&&b.enable(),c&&c.enable()):(b&&b.disable(),c&&c.disable());b=this.getContentElement("info","notiBlockResize");c=this.getContentElement("info","notiBlockWidth");h=this.getContentElement("info","notiBlockHeight");e=this.getContentElement("info","width");g=this.getContentElement("info","height");var f=this.cells.some(a("colspan")),k=this.cells.some(a("rowspan"));b.getElement().getParent().hide();c.getElement().getParent().hide();h.getElement().getParent().hide();
e.enable();g.enable();f&&k?(b.getElement().getParent().show(),e.disable(),g.disable()):f?(c.getElement().getParent().show(),e.disable()):k&&(h.getElement().getParent().show(),g.disable())},onOk:function(){var a=this,b=this._.editor,c=b.document.getSelection(),d=this.cells,e=d[0].getAscendant("table",!0),e=POLARIS.tools.tableMap.findSplitedTables(e),d=1<d.length?d:POLARIS.tools.tableMap.findSplitedCells(d[0],e),g=POLARIS.tools.tableMap.getTableMap(e),f=[];e.forEach(function(a){a.hide()});d.forEach(function(b){a.commitContent(b);
var c=b._index;c||(c=POLARIS.tools.tableMap.getCellIndex(b,g));f.push(c)});var k=this.getContentElement("info","width");k.isChanged()&&(k=parseFloat(k.getValue()),F(f,k,g,e));var k=this.getContentElement("background","borderTop").getValue(),l=this.getContentElement("background","borderBottom").getValue(),m=this.getContentElement("background","borderLeft").getValue(),n=this.getContentElement("background","borderRight").getValue();if(k||l||m||n)E.call(this,{left:m,right:n,top:k,bottom:l},d,e,g),e.forEach(function(a){POLARIS.plugins.tabletools.displayRedBorder(a,
!0,b)});e.forEach(function(a){a.show()});B||(e=c.createBookmarks(),b.forceNextSelectionCheck(),c.selectBookmarks(e),b.selectionChange());b.fire("tableresize")},onLoad:function(){var a={};this.foreach(function(b){b.setup&&b.commit&&(b.setup=POLARIS.tools.override(b.setup,function(c){return function(){c.apply(this,arguments);a[b.id]=b.getValue()}}),b.commit=POLARIS.tools.override(b.commit,function(c){return function(){(a[b.id]!==b.getValue()||C)&&c.apply(this,arguments)}}))})}}});