(function(){POLARIS.dialog.add("movement",function(e){var f=POLARIS.plugins.link,g=function(){for(var a=this.getDialog(),c=["anchorOptions","pageOptions"],e=this.getValue(),d=0;d<c.length;d++){var b=a.getContentElement("info",c[d]);b&&(b=b.getElement().getParent().getParent(),c[d]==e+"Options"?b.show():b.hide())}a.layout();"page"==this.getValue()&&(a=a.getContentElement("info","pageNumber"))&&a.focus()},b=e.lang.movement,d;return{title:b.label,minWidth:207,minHeight:40,resizable:POLARIS.DIALOG_RESIZE_NONE,
contents:[{id:"info",label:e.lang.common.generalTab,title:e.lang.common.generalTab,elements:[{id:"linkType",type:"radio",items:[[b.toAnchor,"anchor"],[b.toPage,"page"]],"default":"anchor",onChange:g,onClick:g,setup:function(a){this.setValue(a.type||"anchor")}},{type:"vbox",id:"anchorOptions",style:"padding-bottom: 11px;",children:[{type:"vbox",id:"selectAnchorText",setup:function(){d=f.getEditorAnchors(e);this.getElement()[d&&d.length?"show":"hide"]()},children:[{type:"vbox",id:"selectAnchor",children:[{type:"select",
id:"anchorName","default":"",label:b.anchorName,style:"width: 100%;",items:[[""]],setup:function(a){this.clear();if(d)for(var c=0;c<d.length;c++)d[c].name&&this.add(d[c].name);a.anchor&&this.setValue(a.anchor.name);(a=this.getDialog().getContentElement("info","linkType"))&&"page"==a.getValue()&&this.focus()},validate:function(){var a=this.getDialog().getContentElement("info","linkType");return a&&"anchor"==a.getValue()&&!this.getValue()?(alert(b.message.noAnchor),!1):!0}}],setup:function(){this.getElement()[d&&
d.length?"show":"hide"]()}}]},{type:"html",id:"noAnchors",html:'\x3cdiv role\x3d"note" tabIndex\x3d"-1" style\x3d"outline:0"\x3e'+POLARIS.tools.htmlEncode(b.noAnchors)+"\x3c/div\x3e",focus:!0,setup:function(){this.getElement()[d&&d.length?"hide":"show"]()}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().hide()}},{type:"vbox",id:"pageOptions",children:[{type:"text",id:"pageNumber",label:b.page,validate:function(){var a=this.getDialog().getContentElement("info",
"linkType");if(a&&"page"==a.getValue()){if(!this.getValue())return alert(b.message.errorPageNumberEmpty),!1;a=parseInt(POLARIS.tools.trim(this.getValue()));if(isNaN(a)||0==a)return alert(b.message.pageNumberError),!1;var c=e.document.find("[polaris-page]");if(!c||c.count()<a)return alert(b.message.exceedPages),!1}return!0}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().hide()}}]}],onShow:function(){var a=this.getParentEditor(),a=f.parseLinkAttributes(a,
null);this.setupContent(a)},onOk:function(){var a=this.getContentElement("info","linkType"),c=new POLARIS.dom.range(e.document);if(a&&"anchor"==a.getValue()){if(a=this.getContentElement("info","anchorName"))if(a=f.getElementByFakeAnchorName(e,a.getValue()))a.scrollIntoView(!0),e.fire("changeEditable",{editable:!0}),e.focus(),c.moveToElementEditEnd(a),c.select()}else if(a&&"page"==a.getValue()&&(a=this.getContentElement("info","pageNumber"),a=parseInt(POLARIS.tools.trim(a.getValue())),a=e.document.findOne('[polaris-page\x3d"'+
a+'"]'))&&(a=a.findOne('[doc-data-role\x3d"polaris-page-body"]'))){var b=a.getTextNodes()[0].getParent();a.scrollIntoView(!0);e.fire("changeEditable",{editable:!0});e.focus();c.setStart(b,0);c.setEnd(b,0);c.select()}}}})})();