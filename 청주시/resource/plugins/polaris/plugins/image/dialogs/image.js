(function(){var w=function(a,m){function w(){var a=arguments,f=this.getContentElement("advanced","txtdlgGenStyle");f&&f.commit.apply(f,a);this.foreach(function(c){c.commit&&"txtdlgGenStyle"!=c.id&&c.commit.apply(c,a)})}function r(a){if(!x){x=1;var f=this.getDialog(),c=f.imageElement;if(c){this.commit(1,c);a=[].concat(a);for(var b=a.length,e,d=0;d<b;d++)(e=f.getContentElement.apply(f,a[d].split(":")))&&e.setup(1,c)}x=0}}var t=/^\s*(\d+)[.]*(\d*)((px)|\%)?\s*$/i,D=/(^\s*(\d+)((px)|\%)?\s*$)|^$/i,u=
/^\d+px$/,y=/data:image\/.*;base64/g,h,v=function(){var a=this.getValue(),f=this.getDialog(),c=a.match(t);c&&(a=c[1]);f.lockRatio&&(c=f.originalElement,"true"==c.getCustomData("isReady")&&("txtHeight"==this.id?(a&&"0"!=a&&(a=Math.round(a/c.$.height*c.$.width)),isNaN(a)||f.setValueOf("info","txtWidth",a)):(a&&"0"!=a&&(a=Math.round(a/c.$.width*c.$.height)),isNaN(a)||f.setValueOf("info","txtHeight",a))));k(f)},k=function(a){if(!a.originalElement||!a.preview)return 1;a.commitContent(4,a.preview);return 0},
x,z=function(a,f){var c=a.getContentElement("info","ratioLock");if(!c)return null;var b=a.originalElement;if(!b)return null;"check"==f?a.userlockRatio||"true"!=b.getCustomData("isReady")||(a.lockRatio=!0):void 0!==f?a.lockRatio=f:(a.userlockRatio=1,a.lockRatio=!a.lockRatio);c.setValue(a.lockRatio);return a.lockRatio},E=function(a){var f=a.originalElement;if("true"==f.getCustomData("isReady")){var c=a.getContentElement("info","txtWidth"),b=a.getContentElement("info","txtHeight");c&&c.setValue(f.$.width);
b&&b.setValue(f.$.height)}k(a)},p=function(a,f){function c(b,c){var a=b.match(t);return a?a[1]:c}if(1==a){this.getDialog();var b="",e="txtWidth"==this.id?"width":"height",d=f.getAttribute(e);d&&(b=c(d,b));b=c(f.getStyle(e),b);this.setValue(b)}},A,B=function f(){var c=this.originalElement,b=POLARIS.document.getById(q);c.setCustomData("isReady","true");c.removeListener("load",f);c.removeListener("error",n);c.removeListener("abort",n);b&&b.setStyle("display","none");this.dontResetSize||E(this);this.firstLoad&&
POLARIS.tools.setTimeout(function(){z(this,"check")},0,this);this.dontResetSize=this.firstLoad=!1;k(this)},n=function c(){var b=this.originalElement,a=POLARIS.document.getById(q);b.removeListener("load",B);b.removeListener("error",c);b.removeListener("abort",c);b=POLARIS.getUrl(POLARIS.plugins.get("image").path+"images/noimage.png");this.preview&&this.preview.setAttribute("src",b);a&&a.setStyle("display","none");z(this,!1)},C=function(c,b){b||(b=POLARIS.dialog.getCurrent().getContentElement("info",
"txtPath"));b&&(c.match(y)?(b.getInputElement().setAttribute("disabled",!0),b.setValue(c.substring(0,100))):(b.getInputElement().removeAttribute("disabled"),b.setValue(c)))};a.on("imgPathChanged",function(c){h=c.data;C(h)});var g=function(c){return POLARIS.tools.getNextId()+"_"+c};g("btnLockSizes");g("btnResetSize");var q=g("ImagePreviewLoader"),l=g("previewLink"),F=g("previewImage"),p={title:a.lang.image["image"==m?"title":"titleButton"],minWidth:298,minHeight:110,resizable:POLARIS.DIALOG_RESIZE_NONE,
onShow:function(){h=null;this.dontResetSize=this.linkEditMode=this.imageEditMode=this.linkElement=this.imageElement=!1;this.firstLoad=!0;this.addLink=!1;var c=this.getParentEditor(),b=c.getSelection(),a=(b=b&&b.getSelectedElement())&&c.elementPath(b).contains("a",1),d=POLARIS.document.getById(q);d&&d.setStyle("display","none");A=new POLARIS.dom.element("img",c.document);this.preview=POLARIS.document.getById(F);this.originalElement=c.document.createElement("img");this.originalElement.setAttribute("alt",
"");this.originalElement.setCustomData("isReady","false");if(a){this.linkElement=a;this.linkEditMode=!0;d=a.getChildren();if(1==d.count()){var g=d.getItem(0).getName();if("img"==g||"input"==g)this.imageElement=d.getItem(0),"img"==this.imageElement.getName()?this.imageEditMode="img":"input"==this.imageElement.getName()&&(this.imageEditMode="input")}"image"==m&&this.setupContent(2,a)}if(this.customImageElement)this.imageEditMode="img",this.imageElement=this.customImageElement,delete this.customImageElement;
else if(b&&"img"==b.getName()&&!b.data("polaris-realelement")||b&&"input"==b.getName()&&"image"==b.getAttribute("type"))this.imageEditMode=b.getName(),this.imageElement=b;this.imageEditMode?(this.cleanImageElement=this.imageElement,this.imageElement=this.cleanImageElement.clone(!0,!0),this.setupContent(1,this.imageElement)):this.imageElement=c.document.createElement("img");!POLARIS.tools.trim(this.getValueOf("info","txtPath"))&&this.preview&&(this.preview.removeAttribute("src"),this.preview.setStyle("display",
"none"))},onOk:function(){a.pagination&&a.pagination.adjustCaret(a);if(this.imageEditMode){var c=this.imageEditMode;"image"==m&&"input"==c&&confirm(a.lang.image.button2Img)?(this.imageElement=a.document.createElement("img"),this.imageElement.setAttribute("alt",""),a.insertElement(this.imageElement)):"image"!=m&&"img"==c&&confirm(a.lang.image.img2Button)?(this.imageElement=a.document.createElement("input"),this.imageElement.setAttributes({type:"image",alt:""}),a.insertElement(this.imageElement)):(this.imageElement=
this.cleanImageElement,delete this.cleanImageElement)}else"image"==m?this.imageElement=a.document.createElement("img"):(this.imageElement=a.document.createElement("input"),this.imageElement.setAttribute("type","image")),this.imageElement.setAttribute("alt","");this.linkEditMode||(this.linkElement=a.document.createElement("a"));this.commitContent(1,this.imageElement);this.commitContent(2,this.linkElement);this.imageElement.getAttribute("style")||this.imageElement.removeAttribute("style");this.imageEditMode?
!this.linkEditMode&&this.addLink?(a.insertElement(this.linkElement),this.imageElement.appendTo(this.linkElement)):this.linkEditMode&&this.addLink?this.imageElement.appendTo(this.linkElement):this.linkEditMode&&!this.addLink&&(a.getSelection().selectElement(this.linkElement),a.insertElement(this.imageElement)):this.addLink?this.linkEditMode?a.insertElement(this.imageElement):(a.insertElement(this.linkElement),this.linkElement.append(this.imageElement,!1)):a.insertElement(this.imageElement)},onLoad:function(){if("image"!=
m){var c=this.getContentElement("advanced","linkOption"),b=this.getContentElement("info","imageSizeOption");c&&(c=c.getElement().getParent().getParent(),c.hide());b&&(b=b.getElement().getParent().getParent(),b.hide())}this._.element.getDocument();this.commitContent=w},onHide:function(){a.execCommand("clearFilePicker");this.preview&&this.commitContent(8,this.preview);this.originalElement&&(this.originalElement.removeListener("load",B),this.originalElement.removeListener("error",n),this.originalElement.removeListener("abort",
n),this.originalElement.remove(),this.originalElement=!1);delete this.imageElement},contents:[{id:"info",label:a.lang.common.generalTab,accessKey:"I",elements:[{type:"hbox",children:[{id:"txtPath",type:"text",style:"width: 205px;",label:a.lang.image.imagePath,required:!0,onChange:function(){var c=this.getDialog(),b=this.getValue(),e="";b.match(y)&&(b=h);b=a.hasListeners("apis.onChangeFileUrl")?e=a.fire("apis.onChangeFileUrl",{url:b}):{url:b};b&&void 0!==b.url&&0<b.url.length?h!==b.url?(h=b.url,C(h,
this)):(c=this.getDialog(),b=c.originalElement,c.preview&&c.preview.removeStyle("display"),b.setCustomData("isReady","false"),(e=POLARIS.document.getById(q))&&e.setStyle("display",""),b.on("load",B,c),b.on("error",n,c),b.on("abort",n,c),b.setAttribute("src",h),c.preview&&(A.setAttribute("src",h),c.preview.setAttribute("src",A.$.src),k(c))):c.preview&&(c.preview.removeAttribute("src"),c.preview.setStyle("display","none"))},setup:function(c,b){if(1==c){var a=b.data("polaris-saved-src")||b.getAttribute("src");
this.getDialog().dontResetSize=!0;h=a;C(a,this);this.setInitValue()}},onShow:function(c){this.getValue().match(y)?this.getInputElement().setAttribute("disabled",!0):this.getInputElement().removeAttribute("disabled")},commit:function(c,b){var e=h;1==c&&(e||this.isChanged())?(b.data("polaris-saved-src",e),b.setAttribute("src",e),b.setAttribute("ondragstart","return false"),e=a.getCommand("showImageBorder").state==POLARIS.TRISTATE_OFF,POLARIS.plugins.image.displayImageBorder(b,e,a)):8==c&&(b.setAttribute("src",
""),b.removeAttribute("src"))},validate:function(){var c=POLARIS.dialog.validate.notEmpty(a.lang.image.urlMissing).apply(this);return!0===c?"false"==this.getDialog().originalElement.getCustomData("isReady")?(this.onChange(),!1):!0:c}},{type:"vbox",filebrowser:"uploadButton",label:a.lang.image.upload,children:[{type:"file",id:"upload",style:"width:100%",hidden:!0,label:a.lang.image.btnUpload,size:38},{type:"fileButton",id:"uploadButton",style:"width: calc(100% - 2px)",filebrowser:"info:txtPath",label:a.lang.image.btnUpload,
"for":["info","upload"]}]}]},{id:"txtImgTitle",type:"text",label:a.lang.image.imgTitle,hidden:!0,"default":"",onChange:function(){k(this.getDialog())},setup:function(c,b){1==c&&this.setValue(b.getAttribute("title"))},commit:function(c,b){1==c?(this.getValue()||this.isChanged())&&b.setAttribute("title",this.getValue()):4==c?b.setAttribute("title",this.getValue()):8==c&&b.removeAttribute("title")}},{type:"hbox",requiredContent:"img{width,height}",widths:["94px","49px","94px","auto"],children:[{type:"text",
id:"txtWidth","default":a.config.defaultAdjustImageSize,maxLength:3,label:a.lang.common.width,onKeyUp:v,onChange:function(){r.call(this,"advanced:txtdlgGenStyle")},validate:function(){var c=this.getValue().match(D),b=!(!c||0===parseInt(c[1],10));b?(b=this.getValue(),c=POLARIS.tools.getContentSizeToUnit(a,"px").width,b=!!(0<b&&b<c),b||(alert(a.lang.div.invalidWidth.replace("%1",c-1)),this.setValue(c-1),this.select(),v.call(this))):alert(a.lang.common.invalidWidth);return b},setup:p,commit:function(c,
b,e){var d=this.getValue();1==c?(d&&a.activeFilter.check("img{width,height}")?b.setStyle("width",POLARIS.tools.cssLength(d)):b.removeStyle("width"),!e&&b.removeAttribute("width")):4==c?d.match(t)?b.setStyle("width",POLARIS.tools.cssLength(d)):(c=this.getDialog().originalElement,"true"==c.getCustomData("isReady")&&b.setStyle("width",c.$.width+"px")):8==c&&(b.removeAttribute("width"),b.removeStyle("width"))}},{type:"vbox",children:[{type:"html",html:"\x26nbsp;"},{type:"html",html:a.lang.common.unitPx,
style:"line-height: 32px;"}]},{type:"text",id:"txtHeight",label:a.lang.common.height,maxLength:3,"default":a.config.defaultAdjustImageSize,onKeyUp:v,onChange:function(){r.call(this,"advanced:txtdlgGenStyle")},validate:function(){var c=this.getValue().match(D);if(c=!(!c||0===parseInt(c[1],10))){var b=this.getValue();if(a.config.wordprocessor){var e=POLARIS.tools.getContentSizeToUnit(a,"px").height,c=!!(0<b&&b<e);c||(alert(a.lang.div.invalidHeight.replace("%1",e-1)),this.setValue(e-1),this.select(),
v.call(this))}}else alert(a.lang.common.invalidHeight);return c},setup:p,commit:function(c,b,e){var d=this.getValue();1==c?(d&&a.activeFilter.check("img{width,height}")?b.setStyle("height",POLARIS.tools.cssLength(d)):b.removeStyle("height"),!e&&b.removeAttribute("height")):4==c?d.match(t)?b.setStyle("height",POLARIS.tools.cssLength(d)):(c=this.getDialog().originalElement,"true"==c.getCustomData("isReady")&&b.setStyle("height",c.$.height+"px")):8==c&&(b.removeAttribute("height"),b.removeStyle("height"))}},
{type:"vbox",children:[{type:"html",html:"\x26nbsp;"},{type:"html",html:a.lang.common.unitPx,style:"line-height: 32px;"}]}]},{type:"hbox",id:"marginBox",widths:["94px","auto","94px","auto"],children:[{type:"text",id:"txtHSpace",maxLength:2,requiredContent:"img{margin-left,margin-right}",label:a.lang.image.hSpace,"default":"0",onKeyUp:function(){k(this.getDialog())},onChange:function(){r.call(this,"advanced:txtdlgGenStyle")},validate:POLARIS.dialog.validate.integer(a.lang.image.validateHSpace),setup:function(c,
b){if(1==c){var a,d;a=b.getStyle("margin-left");d=b.getStyle("margin-right");a=a&&a.match(u);d=d&&d.match(u);a=parseInt(a,10);d=parseInt(d,10);a=a==d&&a;isNaN(parseInt(a,10))&&(a=b.getAttribute("hspace")?a:0);this.setValue(a)}},commit:function(c,b,a){var d=parseInt(this.getValue(),10);1==c||4==c?(isNaN(d)?!d&&this.isChanged()&&(b.removeStyle("margin-left"),b.removeStyle("margin-right")):(b.setStyle("margin-left",POLARIS.tools.cssLength(d)),b.setStyle("margin-right",POLARIS.tools.cssLength(d))),a||
1!=c||b.removeAttribute("hspace")):8==c&&(b.removeAttribute("hspace"),b.removeStyle("margin-left"),b.removeStyle("margin-right"))}},{type:"vbox",children:[{type:"html",html:"\x26nbsp;"},{type:"html",html:a.lang.common.unitPx,style:"line-height: 32px;"}]},{type:"text",id:"txtVSpace",maxLength:2,requiredContent:"img{margin-top,margin-bottom}",label:a.lang.image.vSpace,"default":"0",onKeyUp:function(){k(this.getDialog())},onChange:function(){r.call(this,"advanced:txtdlgGenStyle")},validate:POLARIS.dialog.validate.integer(a.lang.image.validateVSpace),
setup:function(a,b){if(1==a){var e,d;e=b.getStyle("margin-top");d=b.getStyle("margin-bottom");e=e&&e.match(u);d=d&&d.match(u);e=parseInt(e,10);d=parseInt(d,10);e=e==d&&e;isNaN(parseInt(e,10))&&(e=b.getAttribute("vspace")?e:0);this.setValue(e)}},commit:function(a,b,e){var d=parseInt(this.getValue(),10);1==a||4==a?(isNaN(d)?!d&&this.isChanged()&&(b.removeStyle("margin-top"),b.removeStyle("margin-bottom")):(b.setStyle("margin-top",POLARIS.tools.cssLength(d)),b.setStyle("margin-bottom",POLARIS.tools.cssLength(d))),
e||1!=a||b.removeAttribute("vspace")):8==a&&(b.removeAttribute("vspace"),b.removeStyle("margin-top"),b.removeStyle("margin-bottom"))}},{type:"vbox",children:[{type:"html",html:"\x26nbsp;"},{type:"html",html:a.lang.common.unitPx,style:"line-height: 32px;"}]}]},{type:"hbox",id:"imageSizeOption",className:"image_size_option",widths:["147px","auto"],children:[{id:"ratioLock",type:"checkbox",label:a.lang.image.lockRatio,"default":!1,onClick:function(){var a=this.getDialog();z(a);var b=a.originalElement,
e=a.getValueOf("info","txtWidth");"true"==b.getCustomData("isReady")&&e&&(b=b.$.height/b.$.width*e,isNaN(b)||(a.setValueOf("info","txtHeight",Math.round(b)),k(a)))}},{type:"button",id:"btnResetSize",style:"width:calc(100% - 2px)",label:a.lang.image.resetSize,onClick:function(){E(this.getDialog())}}]}]},{id:"advanced",hidden:!0,label:a.lang.common.advancedTab,elements:[{type:"vbox",id:"linkOption",children:[{type:"html",html:"\x3cp\x3e"+a.lang.image.linkTab+"\x3c/p\x3e"},{type:"vbox",requiredContent:"a[href]",
style:"border: 1px solid #a0a2ab; border-radius: 2px; background-color: #f4f5f7; padding: 4px 10px; height:84px;",children:[{id:"txtUrl",type:"text",label:a.lang.image.linkPath,validate:function(a){return function(){var b=this.getValue(),e=/^((?:http|https|ftp|news):\/\/)?(.*)$/,d=!0,g;b&&(g=b.match(e))&&!g[1]&&(alert(a),this.select(),d=!1);return d}}(a.lang.image.invalidLink),style:"width: 100%;","default":"",setup:function(a,b){if(2==a){var e=b.getAttribute("href");this.setValue(e)}},commit:function(c,
b){if(2==c&&(this.getValue()||this.isChanged())){var e=this.getValue();b.setAttribute("href",e);if(this.getValue()||!a.config.image_removeLinkByEmptyURL)this.getDialog().addLink=!0}}},{id:"cmbTarget",type:"select",requiredContent:"a[target]",label:a.lang.common.target,"default":"",items:[[a.lang.common.notSet,""],[a.lang.common.targetNew,"_blank"],[a.lang.common.targetTop,"_top"],[a.lang.common.targetSelf,"_self"],[a.lang.common.targetParent,"_parent"]],setup:function(a,b){2==a&&this.setValue(b.getAttribute("target")||
"")},commit:function(a,b){2==a&&(this.getValue()||this.isChanged())&&b.setAttribute("target",this.getValue())}}]}]},{type:"text",id:"linkId",requiredContent:"img[id]",label:a.lang.common.id,setup:function(a,b){1==a&&this.setValue(b.getAttribute("id"))},commit:function(a,b){1==a&&(this.getValue()||this.isChanged())&&b.setAttribute("id",this.getValue())}},{id:"cmbLangDir",type:"select",requiredContent:"img[dir]",label:a.lang.common.langDir,"default":"",items:[[a.lang.common.notSet,""],[a.lang.common.langDirLtr,
"ltr"],[a.lang.common.langDirRtl,"rtl"]],setup:function(a,b){1==a&&this.setValue(b.getAttribute("dir"))},commit:function(a,b){1==a&&(this.getValue()||this.isChanged())&&b.setAttribute("dir",this.getValue())}},{type:"html",id:"htmlPreview",style:"width:100%",html:"\x3cdiv\x3e"+POLARIS.tools.htmlEncode(a.lang.common.preview)+'\x3cbr\x3e\x3cdiv id\x3d"'+q+'" class\x3d"ImagePreviewLoader" style\x3d"display:none"\x3e\x3cdiv class\x3d"loading"\x3e\x26nbsp;\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"ImagePreviewBox"\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3ca href\x3d"javascript:void(0)" target\x3d"_blank" onclick\x3d"return false;" id\x3d"'+
l+'"\x3e\x3cimg id\x3d"'+F+'" alt\x3d"" /\x3e\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e'}]}]};if(a.config.useDocConvertServer&&a.config.docConvertingUrl)for(g=p.contents[0].elements,l=0;l<g.length;l++)if(g[l].id&&"marginBox"===g[l].id){g=g.splice(l,1);break}return p};POLARIS.dialog.add("image",function(a){return w(a,"image")});POLARIS.dialog.add("imagebutton",function(a){return w(a,"imagebutton")})})();