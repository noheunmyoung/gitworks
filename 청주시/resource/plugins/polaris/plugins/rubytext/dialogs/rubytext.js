(function(){POLARIS.dialog.add("rubytext",function(e){var f=POLARIS.plugins.rubytext;return{title:e.lang.rubytext.label,minWidth:280,minHeight:40,resizable:POLARIS.DIALOG_RESIZE_NONE,contents:[{id:"info",label:e.lang.rubytext.label,title:e.lang.rubytext.label,elements:[{type:"vbox",children:[{type:"text",id:"targetText",label:e.lang.rubytext.targetText,setup:function(a){this.setValue(a.ruby)},commit:function(a){a.ruby=this.getValue()}},{type:"text",id:"rubyText",label:e.lang.rubytext.rubyText,setup:function(a){this.setValue(a.rt)},
commit:function(a){a.rt=this.getValue()}}]}]}],onShow:function(){var a=this.getParentEditor(),b=a.getSelection(),c=null,d={ruby:"",rt:"",rp:""};(c=f.getRubyElement(a))?(b.getSelectedElement()||b.selectElement(c),(a=c.findOne("rt"))?(d.rt=a.getText(),a.remove(),d.ruby=c.getText(),c.append(a)):d.ruby=c.getText()):(c=null,b.getRanges()[0].collapsed||(d.ruby=b.getSelectedText()));this._.selectedElement=c;this.setupContent(d)},onFocus:function(){return this.getContentElement("info","targetText").getValue()?
this.getContentElement("info","rubyText"):this.getContentElement("info","targetText")},onOk:function(){var a={};this.commitContent(a);var b=e.getSelection();if(this._.selectedElement){var c=this._.selectedElement;c.getHtml();c.setHtml(a.ruby);c.appendHtml('\x3crt contentEditable\x3d"false"\x3e'+a.rt+"\x3c/rt\x3e");b.selectElement(c);delete this._.selectedElement}else{var b=b.getRanges()[0],c=b.startContainer.getAscendant("p",1),d=b.endContainer.getAscendant("p",1);c.equals(d)?(b.collapsed||b.deleteContents(),
c=new POLARIS.dom.text(a.ruby),b.insertNode(c),(d=c.getParent())&&d.appendBogus(),d=new POLARIS.style({element:"ruby"}),d.type=POLARIS.STYLE_INLINE,d.applyToRange(b,e),b.startContainer&&b.startContainer.appendHtml('\x3crt contentEditable\x3d"false"\x3e'+a.rt+"\x3c/rt\x3e"),b=new POLARIS.dom.range(e.document),b.moveToPosition(c,POLARIS.POSITION_AFTER_END),e.focus(),b.select()):(new POLARIS.plugins.notification(e,{message:e.lang.rubytext.warning.onlyInParagraph,type:"info",duration:1500,width:200,valign:"top",
align:"center"})).show()}}}})})();