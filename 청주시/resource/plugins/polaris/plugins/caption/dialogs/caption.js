(function(){POLARIS.dialog.add("insertCaption",function(d){var f=d.lang.caption;return{title:f.label,minWidth:180,minHeight:36,resizable:POLARIS.DIALOG_RESIZE_NONE,contents:[{id:"info",label:f.title,title:f.title,elements:[{type:"text",id:"txtValue",label:f.title,required:!0,validate:function(){return this.getValue()?!0:(alert(f.errorCaptionEmpty),!1)},onShow:function(){}}]}],onShow:function(){var a=d.plugins.caption.selectedElement;if(a.hasAscendant("table")){for(;(a=a.getParent())&&"table"!=a.getName(););
var e=a.findOne("caption");e&&(a=this.getContentElement("info","txtValue"))&&a.setValue(e.getText())}else a.hasAscendant("figure")&&(a=d.elementPath(a).contains("figure",1))&&(e=a.findOne("figcaption"))&&(a=this.getContentElement("info","txtValue"))&&a.setValue(e.getText())},onOk:function(){var a=d.plugins.caption.selectedElement,e=POLARIS.tools.trim(this.getValueOf("info","txtValue"));d.fire("saveSnapshot");if(a.hasAscendant("table")){for(;(a=a.getParent())&&"table"!=a.getName(););var b=a.findOne("caption");
b?b.setText(e):(b=d.document.createElement("caption"),b.setText(e),b.addClass("polaris-caption"),b.setAttribute("contentEditable","false"),b.setStyle("text-align","left"),b.setStyle("caption-side","bottom"),a.append(b));d.focus()}else if("img"==a.getName()){if(b=d.elementPath(a).contains("figure",1)){var c=b.findOne("figcaption");c?c.setText(e):(c=d.document.createElement("figcaption"),c.setText(e),c.setStyle("text-align","left"),c.setAttribute("contentEditable","false"),c.setAttribute("ondragstart",
"return false"),b.append(c));a=new POLARIS.dom.range(d.document);a.moveToPosition(b,POLARIS.POSITION_AFTER_END)}else b=d.document.createElement("figure"),b.addClass("polaris-caption"),b.setStyle("background","transparent"),b.setStyle("border","0"),b.setStyle("margin","0"),b.setStyle("padding","0"),b.setStyle("text-align","left"),b.setStyle("display","block"),c=d.document.createElement("figcaption"),c.setText(e),c.setStyle("text-align","left"),c.setStyle("outline","0"),c.setAttribute("ondragstart",
"return false"),b.append(c),(e=a.getAscendant("p"))?(b.insertAfter(e),b.getNext()||(c=d.document.createElement("p"),c.appendBogus(),c.insertAfter(b))):b.insertBefore(a),b.append(a,!0),a=new POLARIS.dom.range(d.document),e?a.moveToPosition(e,POLARIS.POSITION_AFTER_START):a.moveToPosition(b,POLARIS.POSITION_AFTER_END);d.focus();a.select()}else a.hasAscendant("figure")&&(b=d.elementPath(a).contains("figure",1))&&(c=b.findOne("figcaption"))&&(c.setText(e),a=new POLARIS.dom.range(d.document),a.moveToPosition(c,
POLARIS.POSITION_AFTER_END),d.focus(),a.select());d.fire("saveSnapshot")}}})})();