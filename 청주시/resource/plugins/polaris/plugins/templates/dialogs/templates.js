(function(){POLARIS.dialog.add("templates",function(a){function v(a){var b=POLARIS.dom.element.createFromHtml('\x3ca href\x3d"javascript:void(0)" tabIndex\x3d"-1" role\x3d"option" \x3e\x3cdiv class\x3d"polaris_template_item" style\x3d"font-size:12px;"\x3e'+a.title+"\x3c/div\x3e\x3c/a\x3e");b.on("click",function(){var b=[POLARIS.getUrl("plugins/templates/templates/form/"+a.filename)];POLARIS.loadTemplates(b,function(){w(r[a.templatename])})});return b}function w(k){var b=POLARIS.dialog.getCurrent();
a.fire("saveSnapshot");a.setData(k,function(){b.hide();if(a.config.wordprocessor)a.plugins.pagination.setInitialCaret(a,!1),a.config.editMode=1,a.fire("changeEditMode",{editMode:a.config.editMode,fastOpenMode:!1});else{var k=a.createRange();k.moveToElementEditStart(a.editable());k.select()}setTimeout(function(){a.fire("saveSnapshot")},0)})}function t(a){var b=a.data.getTarget(),c=g.equals(b);if(c||g.contains(b)){var e=a.data.getKeystroke(),h=g.getElementsByTag("a"),d;if(h){if(c)d=h.getItem(0);else switch(e){case 40:d=
b.getNext();break;case 38:d=b.getPrevious();break;case 13:case 32:b.fire("click")}d&&(d.focus(),a.data.preventDefault())}}}var f=POLARIS.plugins.get("templates");POLARIS.document.appendStyleSheet(POLARIS.getUrl(f.path+"dialogs/templates.css"));var r={};POLARIS.addTemplatesHTML=function(a,b){r[a]=b};var g,f="polaris_template_list_label_"+POLARIS.tools.getNextNumber(),m=a.lang.templates,u=a.config;return{title:a.lang.templates.title,minWidth:296,minHeight:100,resizable:POLARIS.DIALOG_RESIZE_NONE,contents:[{id:"selectTpl",
label:m.title,elements:[{type:"html",id:"templatesList",focus:!0,html:'\x3cdiv class\x3d"polaris_template_list_div" tabIndex\x3d"-1" role\x3d"listbox" aria-labelledby\x3d"'+f+'"\x3e\x3c/div\x3e\x3cspan class\x3d"polaris_voice_label" id\x3d"'+f+'"\x3e'+m.options+"\x3c/span\x3e"},{type:"html",html:'\x3cdiv style\x3d"height: 6px;"\x3e\x3c/div\x3e'}]}],buttons:[POLARIS.dialog.cancelButton(a,{label:a.lang.common.close})],onShow:function(){g=this.getContentElement("selectTpl","templatesList").getElement();
POLARIS.loadTemplates(u.templates_files,function(){var a=(u.templates||"default").split(",");if(a.length){var b=g;b.setHtml("");for(var c='\x3ctable style\x3d"width: 100%;"\x3e\x3ctr\x3e',e=0,h=a.length;e<h;e++)c+='\x3ctd class\x3d"polaris_template_list_td" style\x3d"border:none"\x3e\x3c/td\x3e';for(var c=POLARIS.dom.element.createFromHtml(c+"\x3c/tr\x3e\x3c/table\x3e"),d=c.getFirst().getLast().getFirst(),e=0,h=a.length;e<h;e++){var f=POLARIS.getTemplates(a[e]).templates,n=f.length,p=POLARIS.dom.element.createFromHtml("\x3cdiv\x3e\x3c/div\x3e");
if(0<n)for(var l=0;l<n;l++){var q=v(f[l]);q.setAttribute("aria-posinset",l+1);q.setAttribute("aria-setsize",n);p.append(q)}else p.setAttribute("class","polaris_template_item_empty");d.append(p);d=d.getNext()}b.append(c)}else g.setHtml('\x3cdiv class\x3d"polaris_template_empty"\x3e\x3cspan\x3e'+m.emptyListMsg+"\x3c/span\x3e\x3c/div\x3e")});this._.element.on("keydown",t)},onHide:function(){this._.element.removeListener("keydown",t)}}})})();